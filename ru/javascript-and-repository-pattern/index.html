<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Реализация паттерна Repository в браузерном JavaScript &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/jquery-toast-plugin/jquery.toast.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/fa/css/all.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery-toast-plugin/jquery.toast.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Sat, 16 Nov 2019 00:00:00 GMT" />
        
            <meta name="description" content="Хорошая архитектура освобождает Вас от привязки к конкретной реализации. Она позволяет Вам отложить момент принятия решения о реализации, и начать конструирование кода еще не имея этого решения. Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую. Вот эта обязанность возложена на паттерн Repository." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/ru/javascript-and-repository-pattern/" />

        <script type="text/javascript">
            setTimeout(function() {
                $.toast({
                    text: 'If you like this site, please support it with an external link or share it with an social nerwork. <br />Subscribe to my <a class="reference external" href="https://t.me/emacsway_log"><i class="fab fa-telegram"></i> Telegram-channel</a>. Thanks!',
                    position: 'bottom-right',
                    hideAfter: 12000
                });
            }, 30000);
        </script>

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="repository-javascript">
<h1><a class="toc-backref" href="#id46">Реализация паттерна Repository в браузерном JavaScript</a><a class="headerlink" href="#repository-javascript" title="Permalink to this headline">¶</a></h1>
<p>Хорошая архитектура освобождает Вас от привязки к конкретной реализации.
Она позволяет Вам отложить момент принятия решения о реализации, и <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">начать конструирование кода еще не имея этого решения</a>.
Принципиально важным моментом является то, что Вы обретаете возможность принять решение в момент наибольшей информированности, а также всегда можете легко подменить конкретную реализацию на любую другую.
Вот эта обязанность возложена на паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.</p>
<div class="contents topic" id="id1">
<p class="topic-title first">Содержание</p>
<ul class="simple">
<li><a class="reference internal" href="#repository-javascript" id="id46">Реализация паттерна Repository в браузерном JavaScript</a></li>
<li><a class="reference internal" href="#domain-model" id="id47">Модель предметной области (Domain Model)</a></li>
<li><a class="reference internal" href="#id8" id="id48">Парадигма реактивного программирования</a></li>
<li><a class="reference internal" href="#repository-orm-javascript" id="id49">Примеры реализаций паттерна Repository и ORM в JavaScript</a></li>
<li><a class="reference internal" href="#domain-model-relationship-ru" id="id50">Реализация реляционных связей</a></li>
<li><a class="reference internal" href="#id10" id="id51">Виды связей по осведомленности</a><ul>
<li><a class="reference internal" href="#id11" id="id52">Однонаправленные ассоциации</a></li>
<li><a class="reference internal" href="#id12" id="id53">Двунаправленные ассоциации</a></li>
<li><a class="reference internal" href="#id13" id="id54">Проектирование ассоциаций</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id17" id="id55">Виды связей по владению</a><ul>
<li><a class="reference internal" href="#id18" id="id56">Ассоциация</a></li>
<li><a class="reference internal" href="#id20" id="id57">Агрегация</a><ul>
<li><a class="reference internal" href="#uml" id="id58">Агрегация в UML</a></li>
<li><a class="reference internal" href="#id22" id="id59">Композиция в UML</a></li>
<li><a class="reference internal" href="#ddd" id="id60">Агрегат в DDD</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id25" id="id61">Виды связей по способу доступа</a><ul>
<li><a class="reference internal" href="#object-references" id="id62">Объектные Ссылки (Object References)</a><ul>
<li><a class="reference internal" href="#id26" id="id63">Классическая реализация создания объектных ссылок</a></li>
<li><a class="reference internal" href="#id27" id="id64">Классическая реализация создания агрегатов</a></li>
<li><a class="reference internal" href="#id28" id="id65">Создание Объектных Ссылок на уровне инфраструктуры</a></li>
<li><a class="reference internal" href="#id29" id="id66">Создание Объектных Ссылок на уровне приложения</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lazy-load" id="id67">Ленивая Загрузка (Lazy Load)</a><ul>
<li><a class="reference internal" href="#ioc" id="id68">Классическая реализация с использованием IoC</a></li>
<li><a class="reference internal" href="#aop-cross-cutting-concerns" id="id69">Реализация посредством AOP (Cross-Cutting Concerns)</a></li>
<li><a class="reference internal" href="#id39" id="id70">Эмуляция Объектных Ссылок (Object References)</a></li>
<li><a class="reference internal" href="#id40" id="id71">Оптимизация и пакетная загрузка</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id41" id="id72">Как реализует связи библиотека?</a></li>
<li><a class="reference internal" href="#id42" id="id73">Исходный код</a></li>
</ul>
</div>
<p>Таким образом, у Вас появляется полная абстракция от источника данных, будь то REST-API, MBaaS, SaaS, IndexedDB, HTML, сторонний сервис по протоколу JSON-RPC или <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.</p>
<blockquote>
<div><p>&#8220;Однако мы часто забываем, что принятие решений лучше всего откладывать до последнего момента.
Дело не в лени или безответственности;
просто это позволяет принять информированное решение с максимумом возможной информации.
Преждевременное решение принимается на базе неполной информации.
Принимая решение слишком рано, мы лишаемся всего полезного, что происходит на более поздних стадиях:
обратной связи от клиентов, возможности поразмышлять над текущим состоянием проекта и опыта применения решений из области реализации.&#8221;</p>
<p>&#8220;We often forget that it is also best to postpone decisions until the last possible moment.
This isn’t lazy or irresponsible; it lets us make informed choices with the best possible information.
A premature decision is a decision made with suboptimal knowledge. We will have that
much less customer feedback, mental reflection on the project, and experience with our
implementation choices if we decide too soon.&#8221;</p>
<p>- &#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; <a class="footnote-reference" href="#fnccode" id="id2">[1]</a></p>
</div></blockquote>
<blockquote>
<div>&#8220;A good architecture allows major decision to be deferred!&#8221;
- <a class="reference external" href="https://youtu.be/Nltqi7ODZTM?t=19m40s">Robert Martin</a></div></blockquote>
<blockquote>
<div><p>&#8220;Вы получаете возможность принимать важные решения настолько поздно,
насколько это возможно.
Это делается для того, чтобы осуществлять связанные с этим
затраты как можно позже.
Кроме того, если вы откладываете решение важных вопросов на более
поздний срок, тем самым вы повышаете вероятность того,
что выбранное вами решение окажется правильным. Другими
словами, сегодня вы должны реализовать только то, без чего сегодня не
обойтись, при этом вы можете рассчитывать на то, что проблемы, решение
которых вы отложили до завтра, развеются сами собой, то есть перестанут
быть актуальными.&#8221;</p>
<p>&#8220;You would make big decisions as
late in the process as possible, to defer the cost of making the decisions and to have
the greatest possible chance that they would be right. You would only implement
what you had to, in hopes that the needs you anticipate for tomorrow wouldn&#8217;t come
true.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id3">[12]</a></p>
</div></blockquote>
<blockquote>
<div>&#8220;The best architects remove architecture by figuring out how to make things shiftable.&#8221;
- <a class="reference external" href="https://youtu.be/VjKYO6DP3fo?t=17m59s">Martin Fowler</a></div></blockquote>
<p>Кроме того, у Вас появляется возможность реализовать паттерны <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> и <a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a>.
Последний часто востребован, так как позволяет выполнить откат состояния локальных объектов в случае, если сохранить данные невозможно (пользователь передумал или ввел невалидные данные).</p>
</div>
<div class="section" id="domain-model">
<h1><a class="toc-backref" href="#id47">Модель предметной области (Domain Model)</a><a class="headerlink" href="#domain-model" title="Permalink to this headline">¶</a></h1>
<p>Наибольшим преимуществом полноценных <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Моделей предметной области</a> в программе является возможность использования принципов Domain-Driven Design (DDD) <a class="footnote-reference" href="#fnddd" id="id4">[5]</a>.
Если Модели содержат исключительно бизнес-логику, и освобождены от служебной логики, то они могут легко читаться специалистами предметной области (т.е. представителем заказчика).
Это освобождает Вас от необходимости создания UML-диаграмм для обсуждений и позволяет добиться максимально высокого уровня взаимопонимания, продуктивности, и качества реализации моделей.</p>
<p>В одном из проектов я пытался реализовать достаточно сложную доменную логику (которая содержала более 30 взаимосвязанных доменных Моделей) в парадигме реактивного программирования с push-алгоритмом, когда атрибуты экземпляра Модели, содержащие аннотации агрегации или зависимые от них, изменяли свое значение путем реакции на изменения других моделей и хранилищ.
Суть в том, что вся эта реактивная логика уже не принадлежала самой доменной модели, и располагалась в разного рода <a class="reference external" href="https://en.wikipedia.org/wiki/Observer_pattern">слушателях</a> и обработчиках.</p>
<blockquote>
<div><p>&#8220;Весь смысл объектов в том, что они позволяют хранить данные вместе с процедурами их обработки.
Классический пример дурного запаха – метод, который больше интересуется не тем классом, в котором он находится, а каким то другим.
Чаще всего предметом зависти являются данные.&#8221;</p>
<p>&#8220;The whole point of objects is that they are a technique to package data with the processes used
on that data. A classic smell is a method that seems more interested in a class other than the one
it actually is in. The most common focus of the envy is the data.&#8221;</p>
<p>- &#8220;Refactoring: Improving the Design of Existing Code&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id5">[8]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Хороший дизайн размещает логику рядом с данными, в отношении которых она действует.&#8221;</p>
<p>&#8220;Good design puts the logic near the data it operates on.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id6">[12]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Если требования архитектурной среды к распределению обязанностей таковы, что элементы, реализующие концептуальные объекты, оказываются физически разделенными, то код больше не выражает модель.</p>
<p>Нельзя разделять до бесконечности, у человеческого ума есть свои пределы, до которых он еще способен соединять разделенное;
если среда выходит за эти пределы, разработчики предметной области теряют способность расчленять модель на осмысленные фрагменты.&#8221;</p>
<p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id7">[5]</a></p>
</div></blockquote>
<p>Это привело к такому огромному количеству хитросплетений слушателей, что превосходство в performance было утрачено, но еще раньше была утрачена читаемость кода.
Даже я не мог на следующий день сказать что делает тот или иной фрагмент кода, не говоря уже о специалисте предметной области.
Мало того, что это в корне разрушало принципы Domain-Driven Design, так это еще и в значительной мере <a class="reference internal" href="../../en/how-to-quickly-develop-high-quality-code/"><span class="doc">снижало скорость разработки новых функций проекта</span></a>.</p>
<p>Надежды на такой подход окончательно рухнули когда выяснилось, что каждый экземпляр модели должен изменять значения своих атрибутов, содержащих аннотации агрегации или зависимых от них, в зависимости от контекста использования (выбранной группировки отображения или критериев фильтрации).</p>
<p>Впоследствии модели вернули себе свои концептуальные контуры и читаемость кода, push-алгоритм был заменен на pull-алгоритм (точнее, на hybrid push-pull), и, вместе с тем, был сохранен механизм реакций при добавлении, изменении или удалении объектов.
Для достижения этого результата пришлось своими силами создать библиотеку реализующую паттерн Repository, так как существующих решений для реляционных данных с качественной кодовой базой я не смог найти.
Получилось что-то вроде Object-Relational Mapping (ORM) для JavaScript, включая паттерн Data Mapper (данные могут трансформироваться (отображаться) между объектами и постоянным хранилищем данных).</p>
</div>
<div class="section" id="id8">
<h1><a class="toc-backref" href="#id48">Парадигма реактивного программирования</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h1>
<p>Сегодня модно увлекаться реактивным программированием.
Знаете ли Вы, что разработчики dojo впервые <a class="reference external" href="https://github.com/dojo/dojo/commit/4bd91a5939d4dbc8a43d673cc279bb3d39ed0895#diff-48ec1f2998cbe6d644df0c9abd32d9d0R35">применили реактивное программирование</a> в своей реализации паттерна Repository еще 13 сентября 2010?</p>
<p>Реактивное программирование дополняет (а не противопоставляет) паттерн <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>, о чем красноречиво свидетельствует опыт <a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">dojo.store</a> и <a class="reference external" href="http://dstorejs.io/">Dstore</a>.</p>
<p>Разработчики dojo - команда высококвалифицированных специалистов, чьи библиотеки используют такие серьезные компании как IBM.
Примером того, насколько серьезно и комплексно они подходят к решению проблем, может служить <a class="reference external" href="http://requirejs.org/docs/history.html">история библиотеки RequireJS</a>.</p>
</div>
<div class="section" id="repository-orm-javascript">
<h1><a class="toc-backref" href="#id49">Примеры реализаций паттерна Repository и ORM в JavaScript</a><a class="headerlink" href="#repository-orm-javascript" title="Permalink to this headline">¶</a></h1>
<p>Примеры простейших реализаций паттерна Repository на JavaScript в проекте <a class="reference external" href="http://todomvc.com/">todomvc.com</a>:</p>
<ul class="simple">
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts">https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts</a></li>
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js">https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js</a></li>
<li>AngularJS: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js">https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js</a></li>
</ul>
<p>Другие реализации:</p>
<ul class="simple">
<li><a class="reference external" href="http://dstorejs.io/">Dstore</a> - yet another excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">Dojo1 Store</a> - Dojo1 implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="http://www.js-data.io/">JS-Data</a> - Object-Relational Mapping (ORM) written by JavaScript for relational data. Does not support composite relations.</li>
<li><a class="reference external" href="https://www.sitepoint.com/9-javascript-libraries-working-with-local-storage/">9 JavaScript Libraries for Working with Local Storage</a> - article with interesting comments.</li>
<li><a class="reference external" href="http://devcenter.kinvey.com/angular/guides/datastore">Kinvey Data Store</a> - implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern by MBaaS Kinvey, <a class="reference external" href="https://github.com/Kinvey/js-sdk/tree/master/src/datastore/src">source code</a></li>
<li><a class="reference external" href="https://github.com/vincentracine/pocketjs">Pocket.js</a> - a wrapper for the window.localStorage. It provides helpful methods which utilise MongoDB&#8217;s proven syntax and provides a powerful lightweight abstraction from the complexity of managing and querying local storage.</li>
<li><a class="reference external" href="https://erikolson186.github.io/zangodb/">ZangoDB</a> is a MongoDB-like interface for HTML5 IndexedDB that supports most of the familiar filtering, projection, sorting, updating and aggregation features of MongoDB, for usage in the web browser (<a class="reference external" href="https://github.com/erikolson186/zangodb">source code</a>).</li>
<li><a class="reference external" href="http://jsstore.net/">JsStore</a> is SQL Like IndexedDb Wrapper. It provides simple api to store, retrieve, delete, remove, and for other advanced Database functionalities (<a class="reference external" href="https://github.com/ujjwalguptaofficial/JsStore">source code</a>).</li>
<li><a class="reference external" href="https://www.odata.org/libraries/">ODATA libraries</a> - multiple implementations of Open Data Protocol (ODATA).</li>
<li><a class="reference external" href="https://github.com/mWater/minimongo">Minimongo</a> - A client-side MongoDB implementation which supports basic queries, including some geospatial ones.</li>
</ul>
<p>Я не могу добавить сюда <a class="reference external" href="https://emberjs.com/">Ember.js</a>, так как он реализует паттерн <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a>.</p>
<p>Отдельно стоит упомянуть библиотеку <a class="reference external" href="https://github.com/persvr/rql">rql</a>, которая позволяет легко реализовывать паттерны <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a> и <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.
Много наработок можно увидеть в проектах <a class="reference external" href="https://github.com/persvr">persvr</a> и <a class="reference external" href="https://github.com/kriszyp">kriszyp</a>.</p>
<p>В текущей статье не рассматриваются примеры реализаций паттернов <a class="reference external" href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a> и <a class="reference external" href="https://martinfowler.com/bliki/CQRS.html">CQRS</a> (о чем ведется речь в статье &#8220;<a class="reference internal" href="../role-of-service-layer-in-cqrs-and-event-sourcing-using-redux-in-angular-as-an-example/"><span class="doc">Роль сервисного слоя в CQRS и Event Sourcing на примере использования Redux в Angular</span></a>&#8221;):</p>
<ul class="simple">
<li>React: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js">https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js</a></li>
<li>React+Alt: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js">https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js</a></li>
<li><a class="reference external" href="https://github.com/dojo/stores">Dojo2 Stores</a> - a predictable, consistent state container for Javascript applications with inspiration from Redux and Flux architectures.</li>
</ul>
<p>Данные паттерны используется в распределенных вычислениях и в системах воссоздающих разные состояния системы, но их преимущества на фронтенде не столь очевидны, особенно учитывая тот факт, что именно на фронтенде реализация бизнес-логики бывает наиболее востребованной.</p>
<p>Отдельно стоит упомянуть реализацию реактивных хранилищ основанных на состоянии с использованием библиотеки RxJS, смотрите, например, <a class="reference external" href="https://github.com/ng-book/angular2-rxjs-chat">angular2-rxjs-chat</a>.</p>
</div>
<div class="section" id="domain-model-relationship-ru">
<span id="id9"></span><h1><a class="toc-backref" href="#id50">Реализация реляционных связей</a><a class="headerlink" href="#domain-model-relationship-ru" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="id10">
<h1><a class="toc-backref" href="#id51">Виды связей по осведомленности</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id52">Однонаправленные ассоциации</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>Однонаправленные связи (unidirectional associations).</p>
</div>
<div class="section" id="id12">
<h2><a class="toc-backref" href="#id53">Двунаправленные ассоциации</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>Двунаправленные ассоциации (Bidirectional Associations)</p>
<blockquote>
<div><p>Двунаправленная ассоциация – это пара свойств, связанных в противоположных направлениях. Класс Car (Автомобиль) имеет свойство owner:Person[1], а класс Person (Личность) имеет свойство cars:Car[*].</p>
<p>A bidirectional association is a pair of properties that are linked together as inverses. The Car class has property owner:Person[1], and the Person class has a property cars:Car[*].</p>
<p>- &#8220;UML Distilled. A Brief Guide to the Standard Object Modeling Language&#8221; 3d edition by Martin Fowler</p>
</div></blockquote>
</div>
<div class="section" id="id13">
<h2><a class="toc-backref" href="#id54">Проектирование ассоциаций</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>В DDD важную роль играет направление связей, и соблюдение принципа минимальной достаточности (&#8220;дистилляция моделей&#8221;  <a class="footnote-reference" href="#fnddd" id="id14">[5]</a>).</p>
<blockquote>
<div><p>In real life, there are lots of many-to-many associations, and a great number are naturally
bidirectional. The same tends to be true of early forms of a model as we brainstorm and explore
the domain. But these general associations complicate implementation and maintenance.
Furthermore, they communicate very little about the nature of the relationship.</p>
<p>There are at least three ways of making associations more tractable.</p>
<ol class="arabic simple">
<li>Imposing a traversal direction</li>
<li>Adding a qualifier, effectively reducing multiplicity</li>
<li>Eliminating nonessential associations</li>
</ol>
<p>It is important to constrain relationships as much as possible. A bidirectional association means
that both objects can be understood only together. When application requirements do not call for
traversal in both directions, adding a traversal direction reduces interdependence and simplifies
the design. Understanding the domain may reveal a natural directional bias.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id15">[5]</a></p>
</div></blockquote>
<blockquote>
<div><p>Minimalist design of associations helps simplify traversal and limit the explosion of relationships
somewhat, but most business domains are so interconnected that we still end up tracing long,
deep paths through object references. In a way, this tangle reflects the realities of the world,
which seldom obliges us with sharp boundaries. It is a problem in a software design.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id16">[5]</a></p>
</div></blockquote>
</div>
</div>
<div class="section" id="id17">
<h1><a class="toc-backref" href="#id55">Виды связей по владению</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id56">Ассоциация</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Ассоциация (association) — это отношение между классами (или точнее, экземплярами этих классов), отражающая некоторое значимые и полезные связи между ними.
В языке UML ассоциации описываются как &#8220;семантические взаимосвязи между двумя или несколькими классификаторами и их экземплярами&#8221;.</p>
<p>Ассоциация (association) - Описание набора однородных связей между объектами двух классов.</p>
<p>Квалифицированная ассоциация (Qualified association) - Ассоциация, участники которой определяются значением квалификатора.</p>
<p>An association is a relationship between classes (more precisely, instances of those classes) that indicates some meaningful and interesting connection.
In the UML, associations are defined as &#8220;the semantic relationship between two or more classifiers that involve connections among their instances.&#8221;</p>
<p>Association - A description of a related set of links between objects of two classes.</p>
<p>Qualified association - An association whose membership is partitioned by the value of a qualifier.</p>
<p>- &#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221; <a class="footnote-reference" href="#fnaumlap" id="id19">[13]</a> by Craig Larman</p>
</div></blockquote>
</div>
<div class="section" id="id20">
<h2><a class="toc-backref" href="#id57">Агрегация</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>Сперва рассмотрим агрегацию с позиции UML.</p>
<div class="section" id="uml">
<h3><a class="toc-backref" href="#id58">Агрегация в UML</a><a class="headerlink" href="#uml" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Агрегация (aggregation) – это отношение типа &#8220;часть целого&#8221;. Точно так же можно сказать, что двигатель и колеса представляют собой части автомобиля.</p>
<p>One of the most frequent sources of confusion in the UML is aggregation and composition. It&#8217;s easy to explain glibly: Aggregation is the part-of relationship. It&#8217;s like saying that a car has an engine and wheels as its parts.</p>
<p>- &#8220;UML Distilled. A Brief Guide to the Standard Object Modeling Language&#8221; 3d edition by Martin Fowler</p>
</div></blockquote>
<blockquote>
<div><p>Агрегация (aggregation) является слабоопределенным типом ассоциации в UML и отображает самую общую зависимость типа &#8220;целое-часть&#8221; (как и многие другие ассоциации).
Этот тип связи не имеет четко определенной семантики в UML, в отличие от обычной ассоциации.
Несмотря на это данный термин введен в спецификации UML.
Зачем? Ответ заключен в цитате Румбаха (одного из основоположников и ключевых разработчиков UML).</p>
<p>&#8220;Несмотря на слабовыраженную семантику агрегации, все считают, что она необходима (по различным причинам).
Думайте о ней как о плацебо в моделировании.&#8221;
- Rumbaugh, J, Jacobson, I., and Booch, G. The Unified Modeling Language Reference Manual, 2e. Reading, MA.: Addison-Wesley, 2004.</p>
<p>Рекомендация. Таким образом, следуя совету создателей UML, не следует использовать агрегацию при моделировании.
Вместо этого по возможности стоит использовать композицию (composition).</p>
<p>Агрегация (Aggregation) - Свойство ассоциации, представляющей отношение &#8220;целое-часть&#8221;, и (обычно) ограничение времени жизни частей временем жизни целого.</p>
<p>Aggregation is a vague kind of association in the UML that loosely suggests whole-part relationships (as do many ordinary associations).
It has no meaningful distinct semantics in the UML versus a plain association, but the term is defined in the UML.
Why?
To quote Rumbaugh (one of the original and key UML creators):</p>
<p>&#8220;In spite of the few semantics attached to aggregation, everybody thinks it is necessary (for different reasons).
Think of it as a modeling placebo.&#8221;
- Rumbaugh, J, Jacobson, I., and Booch, G. The Unified Modeling Language Reference Manual, 2e. Reading, MA.: Addison-Wesley, 2004.</p>
<p>Guideline: Therefore, following the advice of UML creators, don&#8217;t bother to use aggregation in the UML; rather, use composition when appropriate.</p>
<p>Aggregation - A property of an association representing a whole-part relationship and (usually) life-time containment.</p>
<p>- &#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221; <a class="footnote-reference" href="#fnaumlap" id="id21">[13]</a> by Craig Larman</p>
</div></blockquote>
</div>
<div class="section" id="id22">
<h3><a class="toc-backref" href="#id59">Композиция в UML</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Наряду с агрегацией в языке UML есть более определенное свойство – композиция (composition).
Экземпляр класса Point (Точка) может быть частью многоугольника, а может представлять центр окружности, но он не может быть и тем и другим одновременно.
Главное правило состоит в том, что хотя класс может быть частью нескольких других классов, но любой экземпляр может принадлежать только одному владельцу.
На диаграмме классов можно показать несколько классов потенциальных владельцев, но у любого экземпляра класса есть только один объектвладелец.</p>
<p>As well as aggregation, the UML has the more defined property of composition.
An instance of Point may be part of a polygon or may be the center of a circle, but it cannot be both.
The general rule is that, although a class may be a component of many other classes, any instance must be a component of only one owner.
The class diagram may show multiple classes of potential owners, but any instance has only a single object as its owner.</p>
<p>- &#8220;UML Distilled. A Brief Guide to the Standard Object Modeling Language&#8221; 3d edition by Martin Fowler</p>
</div></blockquote>
<blockquote>
<div><p>Композиция – это хороший способ показать свойства, которыми владеют по значению, свойства объектов-значений или свойства, которые имеют определенные и до некоторой степени исключительные права владения другими компонентами.
Агрегация совершенно не имеет смысла; поэтому я не рекомендовал бы применять ее в диаграммах.
Если вы встретите ее в диаграммах других разработчиков, то вам придется покопаться, чтобы понять их значение.
Разные авторы и команды разработчиков используют их в совершенно разных целях.</p>
<p>Composition is a good way of showing properties that own by value, properties to value objects, or properties that have a strong and somewhat exclusive ownership of particular other components.
Aggregation is strictly meaningless; as a result, I recommend that you ignore it in your own diagrams.
If you see it in other people&#8217;s diagrams, you&#8217;ll need to dig deeper to find out what they mean by it.
Different authors and teams use it for very different purposes.</p>
<p>- &#8220;UML Distilled. A Brief Guide to the Standard Object Modeling Language&#8221; 3d edition by Martin Fowler</p>
</div></blockquote>
<blockquote>
<div><p>Композиция, так же известная как композитная агрегация (composite aggregation) является строго определенным типом связи &#8220;целое-часть&#8221; и полезна в некоторых моделях.
Отношение композиции предполагает, что
1) экземпляр части (например Square) в каждый момент времени принадлежит только одному целому (например, Board);
2) часть всегда принадлежит целому (пальцы не существуют отдельно от руки);
3) целое ответственно за создание и удаление своих частей — либо через самостоятельное создание/удаление, либо через взаимодействие с другими объектами.
Следствием этих ограничений является то, что при уничтожении композитного объекта его части должны быть либо уничтожены, либо присоединены к другому композитному объекту.
Например, если реальная настольная игра &#8220;Монополия&#8221; уничтожается, то также уничтожаются и все ее клетки (с концептуальной точки зрения).
Аналогично, если программный объект Board уничтожается, то уничтожаются и программные объекты Square.
Для обозначения композиции в UML используется закрашенный ромб на линииассоциации со стороны целого.</p>
<p>Композитный класс (Composition) - Класс, каждый экземпляр которого состоит из объектов других классов.</p>
<p>Composition, also known as composite aggregation, is a strong kind of whole-part aggregation and is useful to show in some models.
A composition relationship implies that
1) an instance of the part (such as a Square) belongs to only one composite instance (such as one Board) at a time,
2) the part must always belong to a composite (no free-floating Fingers), and
3) the composite is responsible for the creation and deletion of its partseither by itself creating/deleting the parts, or by collaborating with other objects.
Related to this constraint is that if the composite is destroyed, its parts must either be destroyed, or attached to another compositeno free-floating Fingers allowed!
For example, if a physical paper Monopoly game board is destroyed, we think of the squares as being destroyed as well (a conceptual perspective).
Likewise, if a software Board object is destroyed, its software Square objects are destroyed, in a DCD software perspective.
The UML notation for composition is a filled diamond on an association line, at the composite end of the line.</p>
<p>Composition - The definition of a class in which each instance is comprised of other objects.</p>
<p>- &#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221; <a class="footnote-reference" href="#fnaumlap" id="id23">[13]</a> by Craig Larman</p>
</div></blockquote>
</div>
<div class="section" id="ddd">
<h3><a class="toc-backref" href="#id60">Агрегат в DDD</a><a class="headerlink" href="#ddd" title="Permalink to this headline">¶</a></h3>
<p>Итак, то что в UML называется &#8220;композиция&#8221; или &#8220;агрегация&#8221;, в DDD называется просто &#8220;агрегация&#8221;.</p>
<blockquote>
<div><p>AGGREGATE - A cluster of associated objects that are treated as a unit for the purpose of data changes.
External references are restricted to one member of the AGGREGATE , designated as the root.
A set of consistency rules applies within the AGGREGATE&#8217;S boundaries.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id24">[5]</a> by Eric Evans</p>
</div></blockquote>
<p>Агрегаты получили широкое распространение с развитием распределенных хранилищ данных. Границей транзакции является граница агрегата, и все объекты, принадлежащие агрегату, хранятся на одном узле кластера, чем гарантируется их согласованность.</p>
<blockquote>
<div><p>What is an Aggregate?
Two are represented here.
Each Aggregate is composed of one or more Entities, where one Entity is called the Aggregate Root.
Aggregates may also have Value Objects composed on them.
As you see here, Value Objects are used inside both Aggregates.</p>
<p>The Root Entity of each Aggregate owns all the other elements clustered inside it.
The name of the Root Entity is the Aggregate&#8217;s conceptual name.
You should choose a name that properly describes the conceptual whole that the Aggregate models.</p>
<p>Each Aggregate forms a transactional consistency boundary.
This means that within a single Aggregate, all composed parts must be consistent, according to business rules, when the controlling transaction is committed to the database.
This doesn&#8217;t necessarily mean that you are not supposed to compose other elements within an Aggregate that don&#8217;t need to be consistent after a transaction.
After all, an Aggregate also models a conceptual whole.
But you should be first and foremost concerned with transactional consistency.
The outer boundary drawn around Aggregate Type 1 and Aggregate Type 2 represents a separate transaction that will be in control of atomically
persisting each object cluster.</p>
<p>The reasons for the transactional boundary are business motivated, because it is the business that determines what a valid state of the cluster should be at any given time.
In other words, if the Aggregate was not stored in a whole and valid state, the business operation that was performed would be considered incorrect according to business rules.</p>
<p>- &#8220;Domain-Driven Design Distilled&#8221; by Vaughn Vernon</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="id25">
<h1><a class="toc-backref" href="#id61">Виды связей по способу доступа</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h1>
<div class="section" id="object-references">
<h2><a class="toc-backref" href="#id62">Объектные Ссылки (Object References)</a><a class="headerlink" href="#object-references" title="Permalink to this headline">¶</a></h2>
<p>Этот способ связи экземпляров Доменных Моделей применялся достаточно давно.
Часто его называют &#8220;Eager Loading&#8221;.
Со временем он уступил свои позиции Ленивой Загрузке, но, по мере роста применяемости распределенных систем, и, соответственно, по мере роста интереса к понятию Агрегата (как границы транзакции), интерес к нему снова возвратился.</p>
<p>Также этот способ часто применялся в асинхронных приложениях (до появления конструкции async/await), поскольку асинхронное обращение к ленивым связям Доменных Моделей значительно усложняет ясность программного кода, и препятствует оптимизации и пакетной предзагрузке связанных объектов.</p>
<div class="section" id="id26">
<h3><a class="toc-backref" href="#id63">Классическая реализация создания объектных ссылок</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>Чтобы построить объектные ссылки, Data Mapper извлекаемой Domain Model обращается к Data Mapper связанной Domain Model и линкует связанные экземпляры Доменных Моделей при их создании.</p>
<p>Наглядную реализацию можно посмотреть в &#8220;Chapter 12. Object-Relational Structural Patterns :: Foreign Key Mapping&#8221; книги &#8220;Patterns of Enterprise Application Architecture&#8221; by Martin Fowler, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford.
Смотрите Example: Single-Valued Reference (Java): Figure 12.4. Sequence for loading a single-valued field и реализацию класса AlbumMapper. А так же Example: Multitable Find (Java).</p>
<p>Другим хорошим примером может служить легковесный Data Mapper <a class="reference external" href="https://bitbucket.org/emacsway/openorm/src/default/python/">OpenORM</a>.</p>
<p>Этот принцип <a class="reference external" href="http://www.js-data.io/v3.0/docs/relations#section-eagerly-loading-relations">реализован также и в библиотеке js-data</a>.</p>
</div>
<div class="section" id="id27">
<h3><a class="toc-backref" href="#id64">Классическая реализация создания агрегатов</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>Для построения агрегатов часто используется паттерн &#8220;<a class="reference external" href="https://martinfowler.com/eaaCatalog/dependentMapping.html">Dependent Mapping</a>&#8221;, смотрите &#8220;Chapter 12. Object-Relational Structural Patterns :: Dependent Mapping&#8221; книги &#8220;Patterns of Enterprise Application Architecture&#8221; by Martin Fowler, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford. В этом случае один DataMapper ответственен за создание всего агрегата.</p>
<blockquote>
<div><p>Главная идея, лежащая в основе типового решения отображение зависимых объектов, состоит в том, что один класс (зависимый объект) передает другому классу (владельцу) все свои полномочия по взаимодействию с базой данных.
При этом у каждого зависимого объекта должен быть один и только один владелец.</p>
<p>The basic idea behind Dependent Mapping is that one class (the dependent) relies upon some other class (the owner) for its database persistence.
Each dependent can have only one owner and must have one owner.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; by Martin Fowler, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</p>
</div></blockquote>
<blockquote>
<div><p>Зависимый объект может быть владельцем другого зависимого объекта. В этом случае владелец первого зависимого объекта отвечает и за второй зависимый объект.
Вообще говоря, у вас может быть целая иерархия зависимых объектов, контролируемых единственным первичным владельцем.</p>
<p>A dependent may itself be the owner of another dependent. In this case the owner of the first dependent is also responsible for the persistence of the second dependent.
You can have a whole hierarchy of dependents controlled by a single primary owner.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; by Martin Fowler, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</p>
</div></blockquote>
</div>
<div class="section" id="id28">
<h3><a class="toc-backref" href="#id65">Создание Объектных Ссылок на уровне инфраструктуры</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>Для сохранения агрегата целиком часто используются агрегато-ориентированные NoSQL хранилища данных, <a class="reference external" href="https://martinfowler.com/bliki/ApplicationDatabase.html">Application Database</a> и <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#dealing-with-nested-objects">REST-API endpoints</a>.</p>
</div>
<div class="section" id="id29">
<h3><a class="toc-backref" href="#id66">Создание Объектных Ссылок на уровне приложения</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>В DDD связка агрегатов между собой может производиться на уровне логики приложения, например, в обработчике CQRS Command Handler.
Дело в том, что слой Application Logic (или слой Application-specific Business Rules), координирующий работу слоя Business Rules, обладает более лучшими возможностями для предвидения, оптимизации и пакетной загрузки требуемых данных с удаленных источников.
А это играет <a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/antipatterns/chatty-io/">немаловажную роль</a>, когда накладные расходы получения данных с удаленных источников высоки.</p>
<blockquote>
<div><p>Objects within the AGGREGATE can hold references to other AGGREGATE roots.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id30">[5]</a> by Eric Evans</p>
</div></blockquote>
<blockquote>
<div><p>Поскольку один экземпляр АГРЕГАТА может ссылаться на другие экземпляры АГРЕГАТА, можно ли перемещаться по связям достаточно далеко, изменяя различные объекты на пути следования?</p>
<p>Since one Aggregate instance can reference other Aggregate instances, can the associations be navigated deeply, modifying various objects along the way?</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id31">[6]</a> by Vaughn Vernon</p>
</div></blockquote>
<p>При этом нужно отметить, что:</p>
<blockquote>
<div><ol class="arabic simple">
<li>И АГРЕГАТ (Backlogitem), который ссылается, и АГРЕГАТ (Product), на который ссылаются, не должны. изменяться в рамках одной и той же транзакции. В отдельно взятой транзакции может изменяться только один из них.</li>
<li>Если вы изменяете несколько экземпляров в рамках одной транзакции, значит, ваши границы согласованности проведены неправильно. В этом случае, вероятно, в ходе моделирования вы пропустили какую-то концепцию; некая концепция ЕДИНОГО ЯЗЫКА еще не выявлена, хотя она бросается в глаза (такая ситуация была описана выше).</li>
<li>Если вы пытаетесь применить п. 2 и получаете крупнокластерный АГРЕГАТ со всеми его недостатками, указанными ранее, возможно, вам следует использовать концепцию итоговой, а не атомарной согласованности (см. ниже).</li>
</ol>
<ol class="arabic simple">
<li>Both the referencing Aggregate ( BacklogItem ) and the referenced Aggregate ( Product ) must not be modified in the same transaction. Only one or the other may be modified in a single transaction.</li>
<li>If you are modifying multiple instances in a single transaction, it may be a strong indication that your consistency boundaries are wrong. If so, it is possibly a missed modeling opportunity; a concept of your Ubiquitous Language has not yet been discovered although it is waving its hands and shouting at you (see earlier in this chapter).</li>
<li>If you are attempting to apply point 2, and doing so influences a large-cluster Aggregate with all the previously stated caveats, it may be an indication that you need to use eventual consistency (see later in this chapter) instead of atomic consistency.</li>
</ol>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id32">[6]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>При разработке АГРЕГАТОВ может возникнуть желание создать структуру, допускающую обход по глубоким графам объектов, но назначение этого шаблона другое.
В книге [Эванс] утверждается, что один АГРЕГАТ может содержать ссылки на КОРНИ других АГРЕГАТОВ.
Однако мы должны иметь в виду, что это не помещает АГРЕГАТ, на который ссылаются, в границы согласованности АГРЕГАТА, который на него ссылается.
Ссылка не порождает один целостный АГРЕГАТ.
Вместо него существуют два (или больше) АГРЕГАТА, как показано в рис. 10.5.</p>
<p>When designing Aggregates, we may desire a compositional structure that allows for traversal through deep object graphs, but that is not the motivation of the pattern. [Evans] states that one Aggregate may hold references to the Root of other Aggregates. However, we must keep in mind that this does not place the referenced Aggregate inside the consistency boundary of the one referencing it. The reference does not cause the formation of just one whole Aggregate. There are still two (or more), as shown in Figure 10.5.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id33">[6]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>Ссылки по идентификатору не могут полностью исключить навигацию по модели.
Для выполнения поиска к ХРАНИЛИЩУ (12) иногда обращаются из АГРЕГАТА.
Этот способ называется ОТКЛЮЧЕННОЙ МОДЕЛЬЮ ПРЕДМЕТНОЙ ОБЛАСТИ (DISCONNECТED DOМAIN МODEL).
По существу, он представляет собой одну из форм отложенной загрузки.
Впрочем, существуют разные подходы к поиску зависимых объектов с помощью АГРЕГАТОВ:
использовать ХРАНИЛИЩЕ или СЛУЖБУ ПРЕДМЕТНОЙ ОБЛАСТИ (7).
Этой службой может управлять клиент ПРИКЛАДНОЙ СЛУЖБЫ, который потом передает управление АГРЕГАТУ.</p>
<p>Наличие ПРИКЛАДНОЙ СЛУЖБЫ делает АГРЕГАТ независимым от РЕПОЗИТАРИЯ или СЛУЖБЫ ПРЕДМЕТНОЙ ОБЛАСТИ.
Однако в очень сложных и проблемно-ориентированных системах для освобождения от зависимости, возможно, лучше всего передать СЛУЖБУ ПРЕДМЕТНОЙ ОБЛАСТИ в командный метод АГРЕГАТА.
Тогда АГРЕГАТ сможет выполнить двойную диспетчеризацию, обращаясь к СЛУЖБЕ ПРЕДМЕТНОЙ ОБЛАСТИ, и разрешить ссылки.
Повторим, каким бы способом один АГРЕГАТ ни получал доступ к другим АГРЕГАТАМ, ссылка на многочисленные АГРЕГАТЫ в одном запросе не дает оснований для модификации нескольких агрегатов.</p>
<p>Ограничение модели использовать исключительно ссылки с помощью идентификаторов затрудняет обслуживание клиентов, собирающих и прорисовывающих представления ПОЛЬЗОВАТЕЛЬСКОГО ИНТЕРФЕЙСА (14).
Для рассылки представлений в отдельном сценарии использования, вероятно, придется использовать многочисленные ХРАНИЛИЩА.
Если затраты, связанные с выполнением запросов, снижают производительность системы, то, может быть, целесообразно рассмотреть возможность использования тета-обьединений (theta joins) или принципа CQRS.
Библиотека Hibernate, например, использует тета-объединения как средство сборки многих связанных ссылками АГРЕГАТОВ в один объединенный запрос, который может обеспечить просмотр необходимых частей.
Если принцип CQRS и тета-объединения не подходят, вы, возможно, должны достичь баланса между косвенными и прямыми ссылками.</p>
<p>Reference by identity doesn’t completely prevent navigation through the model.
Some will use a Repository (12) from inside an Aggregate for lookup.
This technique is called Disconnected Domain Model, and it’s actually a form of lazy loading.
There’s a different recommended approach, however: Use a Repository or Domain Service (7) to look up dependent objects ahead of invoking the Aggregate behavior.
A client Application Service may control this, then dispatch to the Aggregate.</p>
<p>Having an Application Service resolve dependencies frees the Aggregate from relying on either a Repository or a Domain Service.
However, for very complex and domain-specific dependency resolutions, passing a Domain Service into an Aggregate command method can be the best way to go.
The Aggregate can then double-dispatch to the Domain Service to resolve references.
Again, in whatever way one Aggregate gains access to others, referencing multiple Aggregates in one request does not give license to cause modification on two or more of them.</p>
<p>Limiting a model to using only reference by identity could make it more difficult to serve clients that assemble and render User Interface (14) views.
You may have to use multiple Repositories in a single use case to populate views.
If query overhead causes performance issues, it may be worth considering the use of theta joins or CQRS.
Hibernate, for example, supports theta joins as a means to assemble a number of referentially associated Aggregate instances in a single join query, which can provide the necessary viewable parts.
If CQRS and theta joins are not an option, you may need to strike a balance between inferred and direct object reference.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id34">[6]</a> by Vaughn Vernon</p>
</div></blockquote>
<p>Однако, нужно учитывать, что потребность одного агрегата в данных другого агрегата, для реализации своей бизнес-логики, чаще всего свидетельствует о нарушении принципа SRP, и, в таком случае, зависимый(е) агрегат(ы) иногда лучше разделить (<a class="reference external" href="https://github.com/VaughnVernon/IDDD_Samples_NET/blob/master/iddd_agilepm/Domain.Model/Products/Sprints/CommittedBacklogItem.cs">пример</a>).</p>
</div>
</div>
<div class="section" id="lazy-load">
<h2><a class="toc-backref" href="#id67">Ленивая Загрузка (Lazy Load)</a><a class="headerlink" href="#lazy-load" title="Permalink to this headline">¶</a></h2>
<p>Ленивая Загрузка (<a class="reference external" href="https://www.martinfowler.com/eaaCatalog/lazyLoad.html">Lazy Load</a>) бывает синхронной и асинхронной.</p>
<div class="section" id="ioc">
<h3><a class="toc-backref" href="#id68">Классическая реализация с использованием IoC</a><a class="headerlink" href="#ioc" title="Permalink to this headline">¶</a></h3>
<p>Ключевым моментом при реализации Ленивой Загрузки связей является освобождение Domain Model от логики доступа к источнику данных. Это необходимо как из принципа чистоты архитектуры и проектных решений, чтобы снизить сопряжение (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>), так и из принципа простоты тестирования.</p>
<p>Классический вариант реализации синхронной Ленивой Загрузки связанных объектов, основанный на IoC, можно увидеть в подразделе &#8220;Example: Separating the Finders (Java)&#8221; главы &#8220;Chapter 10. Data Source Architectural Patterns :: Data Mapper&#8221; книги &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id35">[4]</a>.</p>
<p>При этом Доменная Модель осведомлена об интерфейсе доступа к данным, который объявляется на этом же уровне логики, но реализуется на инфраструктурном уровне.</p>
<p>В данном примере использовался паттерн <a class="reference external" href="https://martinfowler.com/eaaCatalog/registry.html">Registry</a> для внедрения реализации интерфейса ArtistFinder (см. класс MapperRegistry), что добавляет Доменной Модели еще и осведомленность об интерфейсе Registry, который представлен, к тому же, еще и глобальным объектом.</p>
<p>Впрочем, последнюю осведомленность можно избежать, если использовать пассивное внедрение зависимостей.</p>
<p>Для этого часто используется <a class="reference external" href="https://en.wikipedia.org/wiki/Currying">Каррирование</a> фабричной функции создания экземпляра Доменной Модели.
Идея с внедрением зависимости через <a class="reference external" href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">замыкания</a> пришла <a class="reference external" href="https://vimeo.com/131636650">из функционального программирования</a> (преобразование более общей функции в более конкретную функцию).
Этот метод хорошо работает, например, в Python, где нет синтаксического различия между инстанционированием экземпляра класса и вызовом обычной функции.</p>
<p>В некоторых проектах я встречал внедрение зависимостей посредством использования замыкания фабрики класса Доменной Модели, а не фабрики экземпляра Доменной Модели.</p>
</div>
<div class="section" id="aop-cross-cutting-concerns">
<span id="domain-model-relationship-implementing-aop-ru"></span><h3><a class="toc-backref" href="#id69">Реализация посредством AOP (Cross-Cutting Concerns)</a><a class="headerlink" href="#aop-cross-cutting-concerns" title="Permalink to this headline">¶</a></h3>
<p>В отличии от только что рассмотренного варианта классической реализации, использующей IoC, реализация посредством AOP (Cross-Cutting Concerns) позволяет полностью освободить Доменную Модель от осведомленности об интерфейсе доступа к данным.
Доменная Модель просто объявляет методы, ответственные за доступ к связанным объектам, но не реализует их.</p>
<p>Когда Repository создает экземпляр доменной модели, он накладывает на этот экземпляр аспект, ответственный за доступ к данным и реализующий все методы, которые были объявлены, но не реализованы, Доменной Моделью.
В этом случае, объект-обертка, реализующий интерфейс оригинального объекта, обычно называется Aspect или Decorator (см. одноименный паттерн в GOF).
Часто в таких случаях можно услышать термин Proxy, но, на самом деле паттерн Proxy имеет немного другое назначение.</p>
<p>Более подробно о Cross-Cutting Concerns можно посмотреть в главах:</p>
<ul class="simple">
<li>&#8220;Chapter 11: Systems :: Cross-Cutting Concerns&#8221;</li>
<li>&#8220;Chapter 11: Systems :: Pure Java AOP Frameworks&#8221;</li>
</ul>
<p>книги &#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; <a class="footnote-reference" href="#fnccode" id="id37">[1]</a> by Robert C. Martin.</p>
<blockquote>
<div><p>If the framework wants you to derive your business objects from its base classes, say no!
Derive proxies instead, and keep those proxies in components that are plugins to your business rules.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id38">[2]</a> by Robert C. Martin</p>
</div></blockquote>
</div>
<div class="section" id="id39">
<h3><a class="toc-backref" href="#id70">Эмуляция Объектных Ссылок (Object References)</a><a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>Для того, чтобы Ленивые Загрузки со стороны клиента выглядели как Объектные Ссылки, часто применяются <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">Descriptors</a>, которые, зачастую, динамически внедряются в класс Доменной Модели в момент инициализации класса посредством метапрограммирования.</p>
</div>
<div class="section" id="id40">
<h3><a class="toc-backref" href="#id71">Оптимизация и пакетная загрузка</a><a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>Недостатком Ленивой Загрузки является N+1 проблема, которая заключается в большом количество запросов к хранилищу данных. С целью оптимизации, ленивые связи <a class="reference external" href="https://docs.sqlalchemy.org/en/13/orm/loading_relationships.html">можно предварительно загрузить пакетно</a>.</p>
</div>
</div>
</div>
<div class="section" id="id41">
<h1><a class="toc-backref" href="#id72">Как реализует связи библиотека?</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h1>
<p>Наша библиотека позволяет реализовать связи как посредством Объектных Ссылок, так и посредством Ленивой Загрузки, включая Cross-Cutting Concerns.
Причем, однажды созданные Объектные Ссылки автоматически реагируют (актуализируются) в ответ на изменения состояния Repository (что особенно актуально для One-To-Many связей).
Реакции реализованы как в парадигме Реактивного программирования, так и в парадигме Событийно-ориентированного программирования (на выбор).
Объектные Ссылки могут создаваться как односторонние, так и двусторонние.</p>
</div>
<div class="section" id="id42">
<h1><a class="toc-backref" href="#id73">Исходный код</a><a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Edge (unstable) repo - <a class="reference external" href="https://github.com/emacsway/store">https://github.com/emacsway/store</a></li>
</ul>
<p>This article in English &#8220;<a class="reference internal" href="../../en/javascript-and-repository-pattern/"><span class="doc">Implementation of Repository pattern for browser&#8217;s JavaScript</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id37">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>&#8221; by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncarch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id38">[2]</a></td><td>&#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncodec" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>&#8220;<a class="reference external" href="http://www.informit.com/store/code-complete-9780735619678">Code Complete</a>&#8221; Steve McConnell</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id35">[4]</a></td><td>&#8220;<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id7">2</a>, <a class="fn-backref" href="#id14">3</a>, <a class="fn-backref" href="#id15">4</a>, <a class="fn-backref" href="#id16">5</a>, <a class="fn-backref" href="#id24">6</a>, <a class="fn-backref" href="#id30">7</a>)</em> &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fniddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id31">1</a>, <a class="fn-backref" href="#id32">2</a>, <a class="fn-backref" href="#id33">3</a>, <a class="fn-backref" href="#id34">4</a>)</em> &#8220;Implementing Domain-Driven Design&#8221; by Vaughn Vernon</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td>&#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnrefactoring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[8]</a></td><td>&#8220;<a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnoovsop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>&#8220;<a class="reference external" href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">OO vs FP</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2011/11/22/Clean-Architecture.html">Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fntca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[11]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnxp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[12]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/extreme-programming-explained-embrace-change-9780321278654">Extreme Programming Explained</a>&#8221; by Kent Beck</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnaumlap" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[13]</td><td><em>(<a class="fn-backref" href="#id19">1</a>, <a class="fn-backref" href="#id21">2</a>, <a class="fn-backref" href="#id23">3</a>)</em> &#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221; by Craig Larman</td></tr>
</tbody>
</table>
<div class="note update admonition">
<p class="first last admonition-title">Updated on Nov 16, 2019</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../en/javascript-and-repository-pattern/">
    <i class="fa fa-arrow-circle-left"></i>
    Implementation of Repository pattern for browser's JavaScript
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../it-hiring/">
    О проблемах подбора персонала в IT-индустрии
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'emacsway';
        var disqus_identifier = '/ru/javascript-and-repository-pattern/';
        var disqus_title = 'Реализация паттерна Repository в браузерном JavaScript';
        var disqus_url = 'https://emacsway.github.io/ru/javascript-and-repository-pattern/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 06, 2017
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    Nov 16, 2019</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/russian/">Russian</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/repository/">Repository</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/javascript/">JavaScript</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/ddd/">DDD</a>
      
    </li>
  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emacsway'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/ru/javascript-and-repository-pattern/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About me</a></li>
</ul>


<ul>
    
    <li class="toctree-l1"><a href="https://t.me/emacsway_log"><i class="fab fa-telegram"></i> Telegram</a></li>
    
</ul>

  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../it/agile/crash-course-in-software-development-economics/">May 05 - Краткий курс по экономике разработки программного обеспечения</a></li>
    
      <li><a href="../soft-skills/psychological-effects/">May 04 - Список психологических эффектов</a></li>
    
      <li><a href="../cqrs-command-and-result/">Apr 02 - Может ли CQRS-команда возвращать результат?</a></li>
    
      <li><a href="../message-ordering-in-competing-consumers/">Mar 31 - О гонке сообщений в условиях конкурирующих подписчиков</a></li>
    
      <li><a href="../domain-events-in-ddd/">May 05 - Domain Events in DDD</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/agile/">Agile</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/angular/">Angular</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">Autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/cqrs/">CQRS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cqs/">CQS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">Cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/career/">Career</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-architecture/">Clean Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-code/">Clean Code</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/communication/">Communication</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/distributed-systems/">Distributed Systems</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/docker/">Docker</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/eip/">EIP</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/economics/">Economics</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/event-sourcing/">Event Sourcing</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/event-driven/">Event-Driven</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/extreme-programming/">Extreme Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/flux/">Flux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/functional-programming/">Functional Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hr/">HR</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hiring/">Hiring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/management/">Management</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/microservices/">Microservices</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/oop/">OOP</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/redux/">Redux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/refactoring/">Refactoring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/scrum/">Scrum</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/service-layer/">Service Layer</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/soft-skills/">Soft Skills</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/software-architecture/">Software Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/software-construction/">Software Construction</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/software-design/">Software Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/tdd/">TDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/xp/">XP</a></li>
      
    
      
    
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2021/">2021 (4)</a></li>
    
  
    
    <li><a href="../../blog/2020/">2020 (1)</a></li>
    
  
    
    <li><a href="../../blog/2019/">2019 (2)</a></li>
    
  
    
    <li><a href="../../blog/2018/">2018 (4)</a></li>
    
  
    
    <li><a href="../../blog/2017/">2017 (9)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2021, Ivan Zakrevskii.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/ru/javascript-and-repository-pattern.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-597ba7fb5af2ef1e"></script>

    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>