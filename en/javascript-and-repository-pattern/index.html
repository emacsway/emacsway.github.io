<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Implementation of Repository pattern for browser’s JavaScript &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/jquery-toast-plugin/jquery.toast.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery-toast-plugin/jquery.toast.min.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Sat, 26 May 2018 00:00:00 GMT" />
        
            <meta name="description" content="Good architecture makes you free from certain implementation. It allows you to postpone the moment of decision on implementation and begin code construction even without the decision. The most important point is that you gain the opportunity to make a decision at the time of the greatest awareness, and you can also easily replace a specific implementation with any other. This responsibility is assigned to the Repository." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/en/javascript-and-repository-pattern/" />

        <script type="text/javascript">
            setTimeout(function() {
                $.toast({
                    text: 'If you like this site, please support it with an external link or share it with an social nerwork. Thanks!',
                    position: 'bottom-right',
                    hideAfter: 7000
                });
            }, 30000);
        </script>

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementation-of-repository-pattern-for-browser-s-javascript">
<h1><a class="toc-backref" href="#id19">Implementation of Repository pattern for browser&#8217;s JavaScript</a><a class="headerlink" href="#implementation-of-repository-pattern-for-browser-s-javascript" title="Permalink to this headline">¶</a></h1>
<p>Good architecture makes you free from certain implementation.
It allows you to postpone the moment of decision on implementation and <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">begin code construction even without the decision</a>.
The most important point is that you gain the opportunity to make a decision at the time of the greatest awareness, and you can also easily replace a specific implementation with any other.
This responsibility is assigned to the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#implementation-of-repository-pattern-for-browser-s-javascript" id="id19">Implementation of Repository pattern for browser&#8217;s JavaScript</a></li>
<li><a class="reference internal" href="#domain-model" id="id20">Domain Model</a></li>
<li><a class="reference internal" href="#reactive-programming-paradigm" id="id21">Reactive programming paradigm</a></li>
<li><a class="reference internal" href="#examples-of-implementations-of-repository-pattern-and-orm-by-javascript" id="id22">Examples of implementations of Repository pattern and ORM by JavaScript</a></li>
<li><a class="reference internal" href="#implementation-of-relationship" id="id23">Implementation of relationship</a><ul>
<li><a class="reference internal" href="#synchronous-programming" id="id24">Synchronous programming</a></li>
<li><a class="reference internal" href="#asynchronous-programming" id="id25">Asynchronous programming</a></li>
<li><a class="reference internal" href="#implementation-of-relationships-by-assigning" id="id26">Implementation of relationships by assigning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-code" id="id27">Source code</a></li>
</ul>
</div>
<p>Thus, you have a complete abstraction from the data source, whether it&#8217;s REST-API, MBaaS, SaaS, IndexedDB, HTML, third-party service for JSON-RPC protocol or <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.</p>
<blockquote>
<div><p>&#8220;We often forget that it is also best to postpone decisions until the last possible moment.
This isn’t lazy or irresponsible; it lets us make informed choices with the best possible information.
A premature decision is a decision made with suboptimal knowledge. We will have that
much less customer feedback, mental reflection on the project, and experience with our
implementation choices if we decide too soon.&#8221;</p>
<p>- &#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; <a class="footnote-reference" href="#fnccode" id="id1">[1]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;A good architecture allows major decision to be deferred!&#8221;</p>
<p>- <a class="reference external" href="https://youtu.be/Nltqi7ODZTM?t=19m40s">Robert Martin</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;You would make big decisions as
late in the process as possible, to defer the cost of making the decisions and to have
the greatest possible chance that they would be right. You would only implement
what you had to, in hopes that the needs you anticipate for tomorrow wouldn&#8217;t come
true.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id2">[11]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;The best architects remove architecture by figuring out how to make things shiftable.&#8221;</p>
<p>- <a class="reference external" href="https://youtu.be/VjKYO6DP3fo?t=17m59s">Martin Fowler</a></p>
</div></blockquote>
<p>In addition, you have the opportunity to implement patterns <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a> and <a class="reference external" href="http://martinfowler.com/eaaCatalog/unitOfWork.html">Unit of Work</a>.
The last one is very often in demand, since it allows you to roll back the state of local objects in case the data can not be saved (the user has changed his mind or entered invalid data).</p>
</div>
<div class="section" id="domain-model">
<h1><a class="toc-backref" href="#id20">Domain Model</a><a class="headerlink" href="#domain-model" title="Permalink to this headline">¶</a></h1>
<p>The greatest advantage of the <a class="reference external" href="http://martinfowler.com/eaaCatalog/domainModel.html">Domain Model</a> in the program is the ability to use the principles of Domain-Driven Design (DDD) <a class="footnote-reference" href="#fnddd" id="id3">[4]</a>.
If the Models contain only business logic, and are devoid of service logic, then they can easily be read by domain expert (ie, the customer&#8217;s representative).
This frees you from the need to create UML diagrams for discussions and allows you to achieve the highest level of mutual understanding, productivity, and quality of implementation of the models.</p>
<p>In one project I tried to implement a fairly complex domain logic (which contained more than 30 interrelated domain model) in the paradigm of reactive programming with push-algorithm, when the attributes of the model instance, containing the aggregation annotations or dependent on them, change its values by reacting to changes in other models and storages.
The bottom line is that all this reactive logic no longer belonged to the domain model itself, and was located in a different sort of <a class="reference external" href="https://en.wikipedia.org/wiki/Observer_pattern">Observers</a> and handlers.</p>
<blockquote>
<div><p>&#8220;The whole point of objects is that they are a technique to package data with the processes used
on that data. A classic smell is a method that seems more interested in a class other than the one
it actually is in. The most common focus of the envy is the data.&#8221;</p>
<p>- &#8220;Refactoring: Improving the Design of Existing Code&#8221; <a class="footnote-reference" href="#fnrefactoring" id="id4">[7]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;Good design puts the logic near the data it operates on.&#8221;</p>
<p>- Kent Beck <a class="footnote-reference" href="#fnxp" id="id5">[11]</a></p>
</div></blockquote>
<blockquote>
<div><p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id6">[4]</a></p>
</div></blockquote>
<p>This led to such a huge number of intricacies of listeners that the superiority in performance was lost, but before that was lost readability.
Even I could not understand the next day what a particular code fragment does, I&#8217;m not talking about the domain expert.
This radically destroyed the principles of Domain-Driven Design, and significantly <a class="reference internal" href="../how-to-quickly-develop-high-quality-code/"><span class="doc">reduced the speed of developing new project features</span></a>.</p>
<p>Hopes for this approach finally collapsed when it was revealed that each instance of the model is to change the values of its attributes that contain aggregate annotations or dependent upon, depending on the context of use (display selected group or filter criteria).</p>
<p>Subsequently, the models recovered their conceptual outlines and code readability, the push algorithm was replaced by a pull-algorithm (to be more precisely, a hybrid push-pull), and at the same time there was preserved the mechanism of reactions on adding, changing or deleting objects.
To achieve this result, I had to create my own library implementing the Repository pattern, since I could not find existing solutions for relational data with quality code base.
This is similar to Object-Relational Mapping (ORM) for JavaScript, including the Data Mapper pattern (the data can be mapped between objects and a persistent data storage).</p>
</div>
<div class="section" id="reactive-programming-paradigm">
<h1><a class="toc-backref" href="#id21">Reactive programming paradigm</a><a class="headerlink" href="#reactive-programming-paradigm" title="Permalink to this headline">¶</a></h1>
<p>Today it is fashionable to get involved in reactive programming.
Did you know that dojo developers first <a class="reference external" href="https://github.com/dojo/dojo/commit/4bd91a5939d4dbc8a43d673cc279bb3d39ed0895#diff-48ec1f2998cbe6d644df0c9abd32d9d0R35">applied reactive programming</a> in their implementation of the Repository pattern as early as September 13, 2010?</p>
<p>Reactive programming complements (rather than contrasts) the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern, as it&#8217;s evidenced by the experience of <a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">dojo.store</a> and <a class="reference external" href="http://dstorejs.io/">Dstore</a>.</p>
<p>The developers of dojo are a team of highly qualified specialists whose libraries are used by such reputable companies as IBM.
An example of how seriously and comprehensively they solves problems is the <a class="reference external" href="http://requirejs.org/docs/history.html">history of the RequireJS library</a>.</p>
</div>
<div class="section" id="examples-of-implementations-of-repository-pattern-and-orm-by-javascript">
<h1><a class="toc-backref" href="#id22">Examples of implementations of Repository pattern and ORM by JavaScript</a><a class="headerlink" href="#examples-of-implementations-of-repository-pattern-and-orm-by-javascript" title="Permalink to this headline">¶</a></h1>
<p>Examples of the simplest implementations of the Repository pattern by JavaScript in the project <a class="reference external" href="http://todomvc.com/">todomvc.com</a>:</p>
<ul class="simple">
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts">https://github.com/tastejs/todomvc/blob/master/examples/angular2/app/services/store.ts</a></li>
<li>Angular2+: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js">https://github.com/tastejs/todomvc/blob/master/examples/angular2_es2015/app/services/todo-store.service.js</a></li>
<li>AngularJS: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js">https://github.com/tastejs/todomvc/blob/master/examples/angularjs/js/services/todoStorage.js</a></li>
</ul>
<p>Other implementations:</p>
<ul class="simple">
<li><a class="reference external" href="http://dstorejs.io/">Dstore</a> - yet another excellent implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="https://dojotoolkit.org/reference-guide/1.10/dojo/store.html">Dojo1 Store</a> - Dojo1 implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern.</li>
<li><a class="reference external" href="http://www.js-data.io/">JS-Data</a> - Object-Relational Mapping (ORM) written by JavaScript for relational data. Does not support composite relations.</li>
<li><a class="reference external" href="https://www.sitepoint.com/9-javascript-libraries-working-with-local-storage/">9 JavaScript Libraries for Working with Local Storage</a> - article with interesting comments.</li>
<li><a class="reference external" href="http://devcenter.kinvey.com/angular/guides/datastore">Kinvey Data Store</a> - implementation of <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern by MBaaS Kinvey, <a class="reference external" href="https://github.com/Kinvey/js-sdk/tree/master/src/datastore/src">source code</a></li>
<li><a class="reference external" href="https://github.com/vincentracine/pocketjs">Pocket.js</a> - a wrapper for the window.localStorage. It provides helpful methods which utilise MongoDB&#8217;s proven syntax and provides a powerful lightweight abstraction from the complexity of managing and querying local storage.</li>
<li><a class="reference external" href="https://erikolson186.github.io/zangodb/">ZangoDB</a> is a MongoDB-like interface for HTML5 IndexedDB that supports most of the familiar filtering, projection, sorting, updating and aggregation features of MongoDB, for usage in the web browser (<a class="reference external" href="https://github.com/erikolson186/zangodb">source code</a>).</li>
<li><a class="reference external" href="http://jsstore.net/">JsStore</a> is SQL Like IndexedDb Wrapper. It provides simple api to store, retrieve, delete, remove, and for other advanced Database functionalities (<a class="reference external" href="https://github.com/ujjwalguptaofficial/JsStore">source code</a>).</li>
<li><a class="reference external" href="https://www.odata.org/libraries/">ODATA libraries</a> - multiple implementations of Open Data Protocol (ODATA).</li>
<li><a class="reference external" href="https://github.com/mWater/minimongo">Minimongo</a> - A client-side MongoDB implementation which supports basic queries, including some geospatial ones.</li>
</ul>
<p>I can not mention <a class="reference external" href="https://emberjs.com/">Ember.js</a> here, because it implements the <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a> pattern.</p>
<p>It is worth also to mention the library <a class="reference external" href="https://github.com/persvr/rql">rql</a>, which makes it easy the implementing of the patterns <a class="reference external" href="http://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a> and <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>.
A lot of implementetions you can find in the projects of <a class="reference external" href="https://github.com/persvr">persvr</a> and <a class="reference external" href="https://github.com/kriszyp">kriszyp</a>.</p>
<p>The current article does not consider examples of implementation of the patterns <a class="reference external" href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a> and <a class="reference external" href="https://martinfowler.com/bliki/CQRS.html">CQRS</a> (which are discussed at the article &#8220;<a class="reference internal" href="../../ru/role-of-service-layer-in-cqrs-and-event-sourcing-using-redux-in-angular-as-an-example/"><span class="doc">Роль сервисного слоя в CQRS и Event Sourcing на примере использования Redux в Angular</span></a>&#8221;):</p>
<ul class="simple">
<li>React: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js">https://github.com/tastejs/todomvc/blob/master/examples/react/js/todoModel.js</a></li>
<li>React+Alt: <a class="reference external" href="https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js">https://github.com/tastejs/todomvc/blob/master/examples/react-alt/js/stores/todoStore.js</a></li>
<li><a class="reference external" href="https://github.com/dojo/stores">Dojo2 Stores</a> - a predictable, consistent state container for Javascript applications with inspiration from Redux and Flux architectures.</li>
</ul>
<p>These patterns are used for distributed computing and for systems recreating different states of the system, but their advantages at the frontend are not so obvious, especially given the fact that the implementation of business logic can be most demanded namely at the frontend.</p>
<p>We should also mention the implementation of reactive storage based on the state and using RxJS libraries, see, for example, <a class="reference external" href="https://github.com/ng-book/angular2-rxjs-chat">angular2-rxjs-chat</a>.</p>
</div>
<div class="section" id="implementation-of-relationship">
<h1><a class="toc-backref" href="#id23">Implementation of relationship</a><a class="headerlink" href="#implementation-of-relationship" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synchronous-programming">
<h2><a class="toc-backref" href="#id24">Synchronous programming</a><a class="headerlink" href="#synchronous-programming" title="Permalink to this headline">¶</a></h2>
<p>At the dawn of ORM, the Data Mappers retrieved from the database all related objects with a single query (see <a class="reference external" href="https://bitbucket.org/emacsway/openorm/src/default/python/">example of implementation</a>).</p>
<p>Domain-Driven Design approaches relationships more strictly, and considers relationships from the point of view of conceptual contour of an aggregate of nested objects <a class="footnote-reference" href="#fnddd" id="id7">[4]</a>.
The object can be accessed either by reference (from a parent object to an embedded object or to another aggregate root) or through the Repository (to an aggregate root).
It is also important the direction of relationships and the principle of minimal sufficiency (&#8220;distillation of models&#8221; <a class="footnote-reference" href="#fnddd" id="id8">[4]</a>).</p>
<blockquote>
<div><p>In real life, there are lots of many-to-many associations, and a great number are naturally
bidirectional. The same tends to be true of early forms of a model as we brainstorm and explore
the domain. But these general associations complicate implementation and maintenance.
Furthermore, they communicate very little about the nature of the relationship.</p>
<p>There are at least three ways of making associations more tractable.</p>
<ol class="arabic simple">
<li>Imposing a traversal direction</li>
<li>Adding a qualifier, effectively reducing multiplicity</li>
<li>Eliminating nonessential associations</li>
</ol>
<p>It is important to constrain relationships as much as possible. A bidirectional association means
that both objects can be understood only together. When application requirements do not call for
traversal in both directions, adding a traversal direction reduces interdependence and simplifies
the design. Understanding the domain may reveal a natural directional bias.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id9">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>Minimalist design of associations helps simplify traversal and limit the explosion of relationships
somewhat, but most business domains are so interconnected that we still end up tracing long,
deep paths through object references. In a way, this tangle reflects the realities of the world,
which seldom obliges us with sharp boundaries. It is a problem in a software design.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id10">[4]</a></p>
</div></blockquote>
<p>With the advent of ORM, lazy evaluation actively began to use to resolve ties synchronous programming.
Python community actifely uses <a class="reference external" href="https://docs.python.org/3/howto/descriptor.html">Descriptors</a> for this purpose, but Java - AOP and Cross-Cutting Concerns <a class="footnote-reference" href="#fnccode" id="id11">[1]</a>.</p>
<p>The key is to free the Domain Model from the data access logic.
This is required by the principle of clean architecture to reduce coupling (<a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a>), and by the principle of simplicity of testing.
The greatest success is achieved by the principle of Cross-Cutting Concerns which completely frees the model from the service logic.</p>
<p>With the advent of ORM the implementation of relationships has become so easy that no one longer think about it.
Where unidirectional relationships are required, developers can easily apply bidirectional relationships.
Utilities for optimizing the selection of related objects have appeared, which implicitly preload all related objects, which significantly reduces the number of calls to the database.</p>
</div>
<div class="section" id="asynchronous-programming">
<h2><a class="toc-backref" href="#id25">Asynchronous programming</a><a class="headerlink" href="#asynchronous-programming" title="Permalink to this headline">¶</a></h2>
<p>The rise in popularity of asynchronous applications has forced us to reconsider the established notions about the implementation of lazy relationships.
Asynchronous access to each lazy relationship of each object significantly complicates the clarity of the program code and prevents optimization.</p>
<p>This facilitated the popularity of object-oriented database in asynchronous programming that allows to save aggregates entirely.
Increasingly, REST-frameworks began to be used to <a class="reference external" href="http://www.django-rest-framework.org/api-guide/serializers/#dealing-with-nested-objects">transfer aggregates of nested objects to the client</a>.</p>
<blockquote>
<div><p>To do anything with an object, you have to hold a reference to it. How do you get that reference?
One way is to create the object, as the creation operation will return a reference to the new
object. A second way is to traverse an association. You start with an object you already know and
ask it for an associated object. Any object-oriented program is going to do a lot of this, and these
links give object models much of their expressive power. But you have to get that first object.</p>
<p>I actually encountered a project once in which the team was attempting, in an enthusiastic
embrace of MODEL-DRIVEN DESIGN , to do all object access by creation or traversal! Their objects
resided in an object database, and they reasoned that existing conceptual relationships would
provide all necessary associations. They needed only to analyze them enough, making their entire
domain model cohesive. This self-imposed limitation forced them to create just the kind of endless
tangle that we have been trying to avert over the last few chapters, with careful implementation of
ENTITIES and application of AGGREGATES . The team members didn&#8217;t stick with this strategy long, but
they never replaced it with another coherent approach. They cobbled together ad hoc solutions
and became less ambitious.</p>
<p>Few would even think of this approach, much less be tempted by it, because they store most oftheir objects in relational databases.
This storage technology makes it natural to use the third way
of getting a reference: Execute a query to find the object in a database based on its attributes, or
find the constituents of an object and then reconstitute it.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id12">[4]</a></p>
</div></blockquote>
<p>The need of processing nested data structures has intensified interest in functional programming, especially in combination with reactive programming paradigm.</p>
</div>
<div class="section" id="implementation-of-relationships-by-assigning">
<h2><a class="toc-backref" href="#id26">Implementation of relationships by assigning</a><a class="headerlink" href="#implementation-of-relationships-by-assigning" title="Permalink to this headline">¶</a></h2>
<p>Although an aggregate is not compatible with Many-To-Many relationships and cross-link hierarchies, it can still refer to the root of another aggregate:</p>
<blockquote>
<div><p>Objects within the AGGREGATE can hold references to other AGGREGATE roots.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id13">[4]</a> by Eric Evans</p>
</div></blockquote>
<blockquote>
<div><p>Since one Aggregate instance can reference other Aggregate instances, can the associations be navigated deeply, modifying various objects along the way?</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id14">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>When designing Aggregates, we may desire a compositional structure that allows for traversal through deep object graphs, but that is not the motivation of the pattern. [Evans] states that one Aggregate may hold references to the Root of other Aggregates. However, we must keep in mind that this does not place the referenced Aggregate inside the consistency boundary of the one referencing it. The reference does not cause the formation of just one whole Aggregate. There are still two (or more), as shown in Figure 10.5.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id15">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<blockquote>
<div><p>Having an Application Service resolve dependencies frees the Aggregate from relying on either a Repository or a Domain Service. However, for very complex and domain-specific dependency resolutions, passing a Domain Service into an Aggregate command method can be the best way to go. The Aggregate can then double-dispatch to the Domain Service to resolve references. Again, in whatever way one Aggregate gains access to others, referencing multiple Aggregates in one request does not give license to cause modification on two or more of them.</p>
<p>- &#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id16">[5]</a> by Vaughn Vernon</p>
</div></blockquote>
<p>The principle of physical assignment of related objects is <a class="reference external" href="http://www.js-data.io/v3.0/docs/relations#section-eagerly-loading-relations">implemented also by the library js-data</a>.</p>
<p>In our library, we implemented both the ability to decompose nested objects and the ability to compose dested objects from flat lists of data in Repositories.
Moreover, selected collections always keeps the actual state.
When you add, change, delete an object in the Repository, the changes automatically propagate to the selected collections.
The library implements this behavior as in the paradigm of reactive programming, as well as in the paradigm of event-driven programming (optional).</p>
<p>There is also the ability to create bidirectional relationships.
But, despite the fact that modern interpreters able to easily collect garbage with reference cycles, it&#8217;s better when child objects are not aware of their parents from a conceptual point of view, if you don&#8217;t have a strong reason for that.</p>
<p>Thus, the implementation of communications does not require any service data access logic for the object, that provides zero <a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Coupling</a> and absolutly clear domain models.
This means that domain model can be instance of the &#8220;class&#8221; Object.</p>
</div>
</div>
<div class="section" id="source-code">
<h1><a class="toc-backref" href="#id27">Source code</a><a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Edge (unstable) repo - <a class="reference external" href="https://github.com/emacsway/store">https://github.com/emacsway/store</a></li>
<li>Canonical repo - <a class="reference external" href="https://github.com/joor/store-js-external">https://github.com/joor/store-js-external</a></li>
</ul>
<p>Эта статья на Русском языке &#8220;<a class="reference internal" href="../../ru/javascript-and-repository-pattern/"><span class="doc">Реализация паттерна Repository в браузерном JavaScript</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id11">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>&#8221; by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncodec" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td>&#8220;<a class="reference external" href="http://www.informit.com/store/code-complete-9780735619678">Code Complete</a>&#8221; Steve McConnell</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td>&#8220;<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id7">3</a>, <a class="fn-backref" href="#id8">4</a>, <a class="fn-backref" href="#id9">5</a>, <a class="fn-backref" href="#id10">6</a>, <a class="fn-backref" href="#id12">7</a>, <a class="fn-backref" href="#id13">8</a>)</em> &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fniddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[5]</td><td><em>(<a class="fn-backref" href="#id14">1</a>, <a class="fn-backref" href="#id15">2</a>, <a class="fn-backref" href="#id16">3</a>)</em> &#8220;Implementing Domain-Driven Design&#8221; by Vaughn Vernon</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td>&#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnrefactoring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[7]</a></td><td>&#8220;<a class="reference external" href="https://martinfowler.com/books/refactoring.html">Refactoring: Improving the Design of Existing Code</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnoovsop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td>&#8220;<a class="reference external" href="http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html">OO vs FP</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[9]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2011/11/22/Clean-Architecture.html">Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fntca" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[10]</td><td>&#8220;<a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a>&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnxp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[11]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/extreme-programming-explained-embrace-change-9780321278654">Extreme Programming Explained</a>&#8221; by Kent Beck</td></tr>
</tbody>
</table>
<div class="note update admonition">
<p class="first last admonition-title">Updated on May 26, 2018</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../ru/django-framework/">
    <i class="fa fa-arrow-circle-left"></i>
    О моем опыте использования Django Framework
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../ru/javascript-and-repository-pattern/">
    Реализация паттерна Repository в браузерном JavaScript
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'emacsway';
        var disqus_identifier = '/en/javascript-and-repository-pattern/';
        var disqus_title = 'Implementation of Repository pattern for browser&amp;#8217;s JavaScript';
        var disqus_url = 'https://emacsway.github.io/en/javascript-and-repository-pattern/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 06, 2017
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    May 26, 2018</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/english/">English</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/repository/">Repository</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/javascript/">JavaScript</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/ddd/">DDD</a>
      
    </li>
  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emacsway'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/en/javascript-and-repository-pattern/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About me</a></li>
</ul>


  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../ru/tdd/">Sep 30 - Test-Driven Development</a></li>
    
      <li><a href="../eda-reference-applications/">Sep 30 - Reference Applications implementing Event-Driven Architecture</a></li>
    
      <li><a href="../../ru/role-of-service-layer-in-cqrs-and-event-sourcing-using-redux-in-angular-as-an-example/">Sep 16 - Роль сервисного слоя в CQRS и Event Sourcing на примере использования Redux в Angular</a></li>
    
      <li><a href="../../ru/easily-about-agile-way-to-rapid-development/">Sep 15 - Про Agile на пальцах. Путь к быстрой разработке.</a></li>
    
      <li><a href="../../ru/anemic-domain-model/">Jan 04 - Про Anemic Domain Model</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/agile/">Agile</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/angular/">Angular</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/architecture/">Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/cqrs/">CQRS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-code/">Clean Code</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/design/">Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/docker/">Docker</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/event-sourcing/">Event Sourcing</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/event-driven/">Event-Driven</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/extreme-programming/">Extreme Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/flux/">Flux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hr/">HR</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hiring/">Hiring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/microservices/">Microservices</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/redux/">Redux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/refactoring/">Refactoring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/scrum/">Scrum</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/service-layer/">Service Layer</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/tdd/">TDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/xp/">XP</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/refactoring/">refactoring</a></li>
      
    
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2019/">2019 (2)</a></li>
    
  
    
    <li><a href="../../blog/2018/">2018 (4)</a></li>
    
  
    
    <li><a href="../../blog/2017/">2017 (9)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2019, Ivan Zakrevsky.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/en/javascript-and-repository-pattern.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-597ba7fb5af2ef1e"></script>

    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>