<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Design of Service Layer and Application Logic &mdash; @emacsway&#39;s blog</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/fa/css/all.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="@emacsway&#39;s blog" href="../../" />
  

   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


    

        <meta http-equiv="Last-Modified" content="Sat, 12 Oct 2019 00:00:00 GMT" />
        
            <meta name="description" content="This article is about organizing Application Logic and designing the Service Layer, Use Case, CQRS, Event Sourcing, MVC, etc." />
        
        
            <meta property="og:image" content="../../_static/logo.jpg" />
            <link rel="image_src" href="../../_static/logo.jpg" />
        

        <link rel="canonical" href="https://emacsway.github.io/en/service-layer/" />

    


  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="@emacsway's blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="design-of-service-layer-and-application-logic">
<h1><a class="toc-backref" href="#id56">Design of Service Layer and Application Logic</a><a class="headerlink" href="#design-of-service-layer-and-application-logic" title="Permalink to this headline">¶</a></h1>
<p>This article is about organizing Application Logic and designing the <a class="reference external" href="https://martinfowler.com/eaaCatalog/serviceLayer.html">Service Layer</a>, Use Case, CQRS, Event Sourcing, MVC, etc.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#design-of-service-layer-and-application-logic" id="id56">Design of Service Layer and Application Logic</a></li>
<li><a class="reference internal" href="#layers-of-logic" id="id57">Layers of logic</a><ul>
<li><a class="reference internal" href="#layered-architecture" id="id58">Layered Architecture</a></li>
<li><a class="reference internal" href="#what-is-business-logic" id="id59">What is Business Logic?</a></li>
<li><a class="reference internal" href="#subtypes-of-business-rules" id="id60">Subtypes of Business Rules</a></li>
<li><a class="reference internal" href="#why-is-separation-of-business-logic-from-application-logic-so-important" id="id61">Why is separation of Business Logic from Application Logic so important?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ways-to-organize-application-logic" id="id62">Ways to Organize Application Logic</a></li>
<li><a class="reference internal" href="#what-is-service" id="id63">What is Service?</a></li>
<li><a class="reference internal" href="#service-types-by-layers-of-logic" id="id64">Service types  by layers of logic</a><ul>
<li><a class="reference internal" href="#domain-service" id="id65">Domain Service</a></li>
<li><a class="reference internal" href="#application-service" id="id66">Application Service</a></li>
<li><a class="reference internal" href="#infrastructure-service" id="id67">Infrastructure Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-types-by-collaboration" id="id68">Service types by collaboration</a><ul>
<li><a class="reference internal" href="#orchestration-service" id="id69">Orchestration Service</a></li>
<li><a class="reference internal" href="#choreography-service" id="id70">Choreography Service</a><ul>
<li><a class="reference internal" href="#common-mistakes-of-design-choreography-service" id="id71">Common mistakes of design Choreography Service</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#service-types-by-communication" id="id72">Service types by communication</a></li>
<li><a class="reference internal" href="#service-types-by-state" id="id73">Service types by state</a><ul>
<li><a class="reference internal" href="#stateless-service" id="id74">Stateless Service</a></li>
<li><a class="reference internal" href="#statefull-service" id="id75">Statefull Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#destination-of-service-layer" id="id76">Destination of Service Layer</a></li>
<li><a class="reference internal" href="#when-not-to-use-service-layer" id="id77">When not to use Service Layer?</a></li>
<li><a class="reference internal" href="#service-is-not-a-wrapper-for-data-mapper" id="id78">Service is not a wrapper for Data Mapper</a></li>
<li><a class="reference internal" href="#implementation-of-service-layer" id="id79">Implementation of Service Layer</a></li>
<li><a class="reference internal" href="#inversion-of-control" id="id80">Inversion of control</a></li>
<li><a class="reference internal" href="#widespread-problem-of-django-applications" id="id81">Widespread problem of Django applications</a></li>
<li><a class="reference internal" href="#problems-of-django-annotation" id="id82">Problems of Django annotation</a></li>
<li><a class="reference internal" href="#peculiar-properties-of-service-layer-on-client-side" id="id83">Peculiar properties of Service Layer on client side</a></li>
<li><a class="reference internal" href="#concurrent-update-issue" id="id84">Concurrent update issue</a></li>
<li><a class="reference internal" href="#cqrs" id="id85">CQRS</a></li>
<li><a class="reference internal" href="#event-sourcing" id="id86">Event Sourcing</a></li>
<li><a class="reference internal" href="#further-reading" id="id87">Further Reading</a></li>
</ul>
</div>
</div>
<div class="section" id="layers-of-logic">
<h1><a class="toc-backref" href="#id57">Layers of logic</a><a class="headerlink" href="#layers-of-logic" title="Permalink to this headline">¶</a></h1>
<p>Before digging deep into it, it would be nice to understand what Application Logic is and how it differs from Business Logic.</p>
<div class="section" id="layered-architecture">
<h2><a class="toc-backref" href="#id58">Layered Architecture</a><a class="headerlink" href="#layered-architecture" title="Permalink to this headline">¶</a></h2>
<p>One of the most cited definitions of key conceptual layers gives Eric Evans:</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>User Interface (or Presentation Layer)</strong></dt>
<dd>Responsible for showing information to the user and interpreting the user&#8217;s
commands. The external actor might sometimes be another computer
system rather than a human user.</dd>
<dt><strong>Application Layer</strong></dt>
<dd>Defines the jobs the software is supposed to do and directs the expressive
domain objects to work out problems. The tasks this layer is responsible
for are meaningful to the business or necessary for interaction with the
application layers of other systems.
This layer is kept thin. It <strong>does not contain business rules</strong> or knowledge, but
only coordinates tasks and delegates work to collaborations of domain
objects in the next layer down. It does not have state reflecting the
business situation, but it can have state that reflects the progress of a task
for the user or the program.</dd>
<dt><strong>Domain Layer (or Model Layer)</strong></dt>
<dd>Responsible for representing concepts of the business, information about
the <strong>business situation, and business rules</strong>. State that reflects the business
situation is controlled and used here, even though the technical details of
storing it are delegated to the infrastructure. This layer is the heart of
business software.</dd>
<dt><strong>Infrastructure Layer</strong></dt>
<dd>Provides generic technical capabilities that support the higher layers:
message sending for the application, persistence for the domain, drawing
widgets for the UI, and so on. The infrastructure layer may also support
the pattern of interactions between the four layers through an
architectural framework.</dd>
</dl>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id1">[4]</a> by Eric Evans</p>
</div></blockquote>
<p>Ward Cunningham gives us the next definitions:</p>
<blockquote>
<div><p>Factor your application classes into four layers in the following way (see Figure 1: FourLayerArchitecture):</p>
<p>The View layer. This is the layer where the physical window and widget objects live. It may also contain Controller classes as in classical MVC. Any new user interface widgets developed for this application are put in this layer. In most cases today this layer is completely generated by a window-builder tool.</p>
<p>The ApplicationModel layer. This layer mediates between the various user interface components on a GUI screen and translates the messages that they understand into messages understood by the objects in the domain model. It is responsible for the flow of the application and controls navigation from window to window. This layer is often partially generated by a window-builder and partially coded by the developer.</p>
<p>The DomainModel layer. This is the layer where most objects found in an OO analysis and design will reside. Examples of the types of objects found in this layer may be Orders, Employees, Sensors, or whatever is appropriate to the problem domain.</p>
<p>The Infrastructure layer. This is where the objects that represent connections to entities outside the application (specifically those outside the object world) reside. Examples of objects in this layer would include SQLTables, 3270Terminals, SerialPorts, SQLBrokers and the like.</p>
<p>- <a class="reference external" href="http://wiki.c2.com/?FourLayerArchitecture">Four Layer Architecture</a>, Ward Cunningham</p>
</div></blockquote>
<p>But what does the term Business itself mean?
Misunderstanding of this term often leads to significant design problems.</p>
</div>
<div class="section" id="what-is-business-logic">
<h2><a class="toc-backref" href="#id59">What is Business Logic?</a><a class="headerlink" href="#what-is-business-logic" title="Permalink to this headline">¶</a></h2>
<p>The most authoritative explanation of the term <a class="reference external" href="http://wiki.c2.com/?CategoryBusiness">Business</a> can be found, as usual, on the Ward Cunningham website:</p>
<blockquote>
<div>Software intersects with the Real World. Imagine that.</div></blockquote>
<p>There you can find a definition of <a class="reference external" href="http://wiki.c2.com/?BusinessRule">Business Rule</a>:</p>
<blockquote>
<div><p>A Business Rule (in a programming context) is knowledge that gets applied to a set of data to create new value. Or it may be a rule about how to create, modify, or remove data. Or perhaps it is a rule that specifies when certain processes occur.</p>
<p>For example, we have a rule about email addresses &#8211; when the Driver Name field on our object identifier changes, we erase the email address. When we receive a new email address, we make sure that it contains an &#8220;&#64;&#8221; sign and a valid domain not on our blacklist.</p>
</div></blockquote>
<p><a class="reference external" href="http://wiki.c2.com/?BusinessLogicDefinition">Business Logic Definition</a>:</p>
<blockquote>
<div><p>Business logic is that portion of an enterprise system which determines how data is:</p>
<ul class="simple">
<li>Transformed and/or calculated. For example, business logic determines how a tax total is calculated from invoice line items.</li>
<li>Routed to people or software systems, aka workflow.</li>
</ul>
</div></blockquote>
<p>The term Business should be distinguished from the term <a class="reference external" href="http://wiki.c2.com/?CategoryBusinessDomain">Business Domain</a>:</p>
<blockquote>
<div>A category about the business domain, such as accounting, finance, inventory, marketing, tracking, billing, reporting, charting, taxes, etc.</div></blockquote>
<p>You should also distinguish Business from <a class="reference external" href="http://wiki.c2.com/?BusinessProcess">Business Process</a>:</p>
<blockquote>
<div><p>A Business Process is some reproduceable process within an organization. Often it is a something that you want to setup once and reuse over and over again.</p>
<p>Companies spend a lot of time and money identifying Business Processes, designing the software that captures a Business Process and then testing and documenting these processes.</p>
<p>One example of a Business Process is &#8220;Take an order on my web site&#8221;. It might involve a customer, items from a catalog and a credit card. Each of these things is represented by business objects and together they represent a Business Process.</p>
</div></blockquote>
<p>Wikipedia <a class="reference external" href="https://en.wikipedia.org/wiki/Business_logic">gives us the following definition of the term Business Logic</a>:</p>
<blockquote>
<div>In computer software, business logic or domain logic is the part of the program that encodes the real-world Business Rules that determine how data can be created, stored, and changed. It is contrasted with the remainder of the software that might be concerned with lower-level details of managing a database or displaying the user interface, system infrastructure, or generally connecting various parts of the program.</div></blockquote>
<p>And explains how Business Logic differs from Business Rules:</p>
<blockquote>
<div>Business logic should be distinguished from business rules.[&#8220;<a class="reference external" href="http://c2.com/cgi/wiki?BusinessLogicDefinition">Definition of business logic</a>&#8220;] Business logic is the portion of an enterprise system which determines how data is transformed or calculated, and how it is routed to people or software (workflow). Business rules are formal expressions of business policy. Anything that is a process or procedure is business logic, and anything that is neither a process nor a procedure is a business rule. Welcoming a new visitor is a process (workflow) consisting of steps to be taken, whereas saying every new visitor must be welcomed is a business rule. Further, business logic is procedural whereas business rules are declarative.[William Ulrich. &#8220;<a class="reference external" href="https://web.archive.org/web/20131224094752/http://www.omg.org/news/meetings/tc/mn/special-events/br/Ulrich.pdf">OMG Business Rules Symposium</a>&#8221; (archived from <a class="reference external" href="http://www.omg.org/news/meetings/tc/mn/special-events/br/Ulrich.pdf">the original</a> on 2013-12-24)]</div></blockquote>
<p>Craig Larman sees the term Business as synonymous with Domain, and in &#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221;, he cites them side by side many times, complementing one term with another in parentheses.
He gives the next definition for the term Business Rules:</p>
<blockquote>
<div><p>Business Rules - Business rules (also called Domain Rules) typically describe requirements or policies that transcend one software project - they are required in the domain or business, and many applications may need to conform to them. An excellent example is government tax laws. Domain rule details may be recorded in the Supplementary Specification, but because they are usually more enduring and applicable than for one software project, placing them in a central Business Rules artifact (shared by all analysts of the company) makes for better reuse of the analysis effort.</p>
<p>&lt;...&gt;</p>
<p>The Business Rules (or Domain Rules) capture long-living and spanning rules or policies, such as tax laws, that transcend one particular application.</p>
<p>&lt;...&gt;</p>
<p>Domain rules [Ross97, GK00] dictate how a domain or business may operate. They are not requirements of any one application, although an application’s requirements are often influenced by domain rules. Company policies, physical laws (such as how oil flows underground), and government laws are common domain rules.</p>
<p>They are commonly called business rules, which is the most common type, but that term is poor, as many software applications are for non-business problems, such as weather simulation or military logistics. A weather simulation has &#8220;domain rules,&#8221; related to physical laws and relationships, that influence the application requirements.</p>
<p>It’s useful to identify and record domain rules in a separate application-independent artifact - what the UP calls the Business Rules artifact - so that this analysis can be shared and reused across the organization and across projects, rather than buried within a project-specific document.</p>
<p class="attribution">&mdash;&#8220;Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development&#8221; by Craig Larman</p>
</div></blockquote>
<p>Let me summarize this in my own words:</p>
<dl class="docutils">
<dt><strong>Business Logic</strong></dt>
<dd>is a modeling of objects and processes of the domain (i.e., the real world).</dd>
<dt><strong>Application Logic</strong></dt>
<dd>is what provides and coordinates the operation of the business logic.</dd>
</dl>
</div>
<div class="section" id="subtypes-of-business-rules">
<h2><a class="toc-backref" href="#id60">Subtypes of Business Rules</a><a class="headerlink" href="#subtypes-of-business-rules" title="Permalink to this headline">¶</a></h2>
<p>In &#8220;Clean Architecture,&#8221; Robert Martin divides Business Rules into two types:</p>
<ul>
<li><p class="first">Application-specific Business Rules</p>
</li>
<li><p class="first">Application-independent Business Rules</p>
<blockquote>
<div><p>Thus we find the system divided into decoupled horizontal layers—the UI, application-specific Business Rules, application-independent Business Rules, and the database, just to mention a few.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id2">[2]</a> by Robert C. Martin</p>
</div></blockquote>
</li>
</ul>
<p>Chapters 16, 20 and 22 of Clean Architecture explain in detail the types of Business Rules.</p>
<p>At the same time, Robert Martin their outputs 4 layers : Entities, Use Cases, Interface Adapters, Frameworks and Drivers.</p>
<p>It should be noted that by &#8220;Business Rules&#8221; Robert Martin means not only rules, but also procedures, blurring the line between &#8220;Business Rules&#8221; and &#8220;Business Logic&#8221;:</p>
<blockquote>
<div><p>Strictly speaking, business rules are rules or procedures that make or save the business money.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id3">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>Here is a slight contradiction.
On the one hand, he reduces the whole essence of &#8220;Business Rules&#8221; to the fact that they belong exclusively to the real world:</p>
<blockquote>
<div><p>Strictly speaking, business rules are rules or procedures that make or save the business money.
Very strictly speaking, these rules would make or save the business money, <strong>irrespective of whether they were implemented on a computer</strong>.
They would make or save money <strong>even if they were executed manually</strong>.</p>
<p>The fact that a bank charges N% interest for a loan is a business rule that makes the bank money.
<strong>It doesn’t matter if a computer program calculates the interest, or if a clerk with an abacus calculates the interest.</strong></p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id4">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>Next Robert Martin says important information - &#8220;Business Rules&#8221; are the reason for the existence of the Application.
It follows from this that the Application can no longer be the cause for the existence of &#8220;Business Rules&#8221;:</p>
<blockquote>
<div><p><strong>Business rules are the reason a software system exists.</strong>
They are the core functionality.
They carry the code that makes, or saves, money.
They are the family jewels.</p>
<p>The business rules should remain pristine, unsullied by baser concerns such as the user interface or database used.
Ideally, the code that represents the business rules should be the heart of the system, with lesser concerns being plugged in to them.
The business rules should be the most independent and reusable code in the system.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id5">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>However, on the other hand, he admits the existence of &#8220;Business Rules&#8221; in the context of the application&#8217;s operation:</p>
<blockquote>
<div><p>Not all business rules are as pure as Entities.
<strong>Some business rules make or save money for the business by defining and constraining the way that an automated system operates.</strong>
These rules would not be used in a manual environment, because <strong>they make sense only as part of an automated system.</strong></p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id6">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>It&#8217;s not clear - &#8220;Business rules are the reason a software system exists&#8221; or &#8220;they make sense only as part of an automated system&#8221;?</p>
<p>There is a slight mutual exclusion here, and this is exactly the reason why I adhere to the wording of Eric Evans - &#8220;Application Layer does not contain business rules&#8221;.</p>
<p>It is clear that there is a lack of a term for expressing different things, and Robert Martin decides to differentiate the already existing term &#8220;Business Rules&#8221;, dividing it into two levels - &#8220;Critical Business Rules&#8221; and &#8220;Application-specific Business Rules&#8221;:</p>
<blockquote>
<div><p>A use case is a description of <strong>the way that an automated system is used</strong>.
It specifies the input to be provided by the user, the output to be returned to the user, and the processing steps involved in producing that output.
A use case describes <strong>application-specific business rules</strong> as opposed to the <strong>Critical Business Rules</strong> within the Entities.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id7">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>But then he reduces the responsibilities of the Use Case to those of the Application Logic, and emphasizes that the Use Case coordinates the &#8220;Critical Business Rules&#8221; implemented as Entities:</p>
<blockquote>
<div><p>Use cases contain the rules that specify how and when the Critical Business Rules within the Entities are invoked.
Use cases control the dance of the Entities.</p>
<p>&lt;...&gt;</p>
<p>Why are Entities high level and use cases lower level?
Because use cases are specific to a single application and, therefore, are closer to the inputs and outputs of that system.
<strong>Entities are generalizations that can be used in many different applications, so they are farther from the inputs and outputs of the system.</strong>
Use cases depend on Entities; Entities do not depend on use cases.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id8">[2]</a> by Robert C. Martin, Chapter 20 &#8220;Business Rules&#8221;</p>
</div></blockquote>
<p>Although, Robert Martin allocate the separate category UseCase (Interactor) classes for Application-specific Business Rules, in practice, this level is often rounded to Application Logic level.
For example, Martin Fowler and Randy Stafford divide Business Logic into two types - Domain Logic and Application Logic:</p>
<blockquote>
<div><p>Like Transaction Script (110) and Domain Model (116), Service Layer is a pattern for organizing <strong>business logic</strong>.
Many designers, including me, like to divide &#8220;<strong>business logic</strong>&#8221; into two kinds: &#8220;domain logic,&#8221; having to
do purely with the problem domain (such as strategies for calculating revenue recognition on a contract), and
&#8220;application logic,&#8221; having to do with application responsibilities [Cockburn UC] (such as notifying contract
administrators, and integrated applications, of revenue recognition calculations). Application logic is
sometimes referred to as &#8220;workflow logic,&#8221; although different people have different interpretations of
&#8220;workflow.&#8221;</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id9">[3]</a> by Martin Fowler, Randy Stafford</p>
</div></blockquote>
<p>In some places, he is inclined to refer &#8220;Business Rules&#8221; to Domain Logic:</p>
<blockquote>
<div><p>The problem came with domain logic: business rules, validations, calculations, and the like.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id10">[3]</a> by Martin Fowler</p>
</div></blockquote>
<p>And even he admits the presence of a certain vagueness:</p>
<blockquote>
<div><p>Then there&#8217;s the matter of what comes under the term &#8220;business logic.&#8221;
I find this a curious term because there are few things that are less logical than business logic.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id11">[3]</a> by Martin Fowler</p>
</div></blockquote>
</div>
<div class="section" id="why-is-separation-of-business-logic-from-application-logic-so-important">
<h2><a class="toc-backref" href="#id61">Why is separation of Business Logic from Application Logic so important?</a><a class="headerlink" href="#why-is-separation-of-business-logic-from-application-logic-so-important" title="Permalink to this headline">¶</a></h2>
<p>Since the purpose of creating an application is precisely the implementation of Business Logic, it is important to ensure their portability and to separate them from the Application Logic.
These two different kinds of rules will change  at different times, at different rates, and for different reasons - so they should be separated so that they can be independently changed <a class="footnote-reference" href="#fncarch" id="id12">[2]</a> .
Grady Booch said that &#8220;Architecture represents the significant design decisions that shape a system, where significant is measured by cost of change <a class="footnote-reference" href="#fncarch" id="id13">[2]</a> .&#8221;</p>
</div>
</div>
<div class="section" id="ways-to-organize-application-logic">
<h1><a class="toc-backref" href="#id62">Ways to Organize Application Logic</a><a class="headerlink" href="#ways-to-organize-application-logic" title="Permalink to this headline">¶</a></h1>
<p>Four ways to organize Application Logic are widespread:</p>
<ol class="arabic simple">
<li>Orchestration Service (&#8220;request/response&#8221;, i.e. the service is aware of the interface of other services) aka Service Layer.</li>
<li>Choreography Service (Event-Driven, т.е. <a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/choreography">loosely coupled</a>), which is a derivative of Command pattern and is used commonly in Event-Driven Architecture (in particular, in CQRS and Event Sourcing applications; a reducer in Redux is a good example), and in DDD applications (a subscriber of Domain/Integration Event).</li>
<li><a class="reference external" href="https://martinfowler.com/eaaCatalog/frontController.html">Front Controller</a> and <a class="reference external" href="https://martinfowler.com/eaaCatalog/applicationController.html">Application Controller</a> (which are also kinds of Command pattern).</li>
</ol>
<blockquote>
<div><p>&#8220;A Front Controller handles all calls for a Web site, and is usually structured in two parts: a Web handler and a command hierarchy.&#8221;</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221;  <a class="footnote-reference" href="#fnpoeaa" id="id14">[3]</a> by Martin Fowler and others.</p>
</div></blockquote>
<blockquote>
<div><p>&#8220;For both the domain commands and the view, the application controller needs a way to store something it can invoke.
A Command [Gang of Four] is a good choice, since it allows it to easily get hold of and run a block of code.&#8221;</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221;  <a class="footnote-reference" href="#fnpoeaa" id="id15">[3]</a> by Martin Fowler and others.</p>
</div></blockquote>
<p>4. <a class="reference external" href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html">Use Case</a> (<a class="reference external" href="http://wiki.c2.com/?UseCase">see also</a>), which also is a kind of Command pattern.
At 15:50 Robert C. Martin points to a <a class="reference external" href="https://youtu.be/Nsjsiz2A9mg?t=15m45s">parallel between Use Case and Command pattern</a>.</p>
<p>In fact, even <a class="reference external" href="https://refactoring.com/catalog/replaceFunctionWithCommand.html">Method Object</a> is a derivative of Command pattern.</p>
<p>Use Case is necessary because there are application-specific Business Rules which do not make sense outside the context of the application.
It makes them independent from the Application Logic using inverse control (IoC).</p>
<p>If the Use Case did not contain Business Logic, then there would be no sense in separating it from Page Controller, otherwise the application would try to abstract itself from itself.</p>
<p>As you can see, varieties of the Command pattern are widely used to organize the Application Logic.</p>
<p>The listed methods organize, first of all, Application Logic, and only then - Business Logic, which is not obligatory for them, except for Use Case, because otherwise it would have no reason to exist.</p>
<p>With proper organization of the Business Logic, and high quality of ORM (if used, of course), the dependence of the Business Logic of the application will be minimal.
The main difficulty of any ORM is to provide access to related objects without mixing Application Logic (and data access logic) into Domain Models, this topic we will discuss in one of the next posts.</p>
<p>Understanding the common features of the methods of organizing Application Logic allows us to design more flexible applications, and, as a result, more painlessly change the architectural style, for example, from Layered to Event-Driven.
This topic is covered in part in Chapter 16 &#8220;Independence&#8221; of &#8220;Clean Architecture&#8221; by Robert C. Martin, and in section &#8220;Premature Decomposition&#8221; of Chapter 3 &#8220;How to Model Services&#8221; of &#8220;Building Microservices&#8221; by Sam Newman.</p>
</div>
<div class="section" id="what-is-service">
<h1><a class="toc-backref" href="#id63">What is Service?</a><a class="headerlink" href="#what-is-service" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>SERVICE - An operation offered as an interface that stands alone in the model, with no encapsulated state.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id16">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>In some cases, the clearest and most pragmatic design includes operations that do not
conceptually belong to any object. Rather than force the issue, we can follow the natural contours
of the problem space and include SERVICES explicitly in the model.</p>
<p>There are important domain operations that can&#8217;t find a natural home in an ENTITY or VALUE
OBJECT . Some of these are intrinsically activities or actions, not things, but since our modeling
paradigm is objects, we try to fit them into objects anyway...</p>
<p>A SERVICE is an operation offered as an interface that stands alone in the model, without
encapsulating state, as ENTITIES and VALUE OBJECTS do. S ERVICES are a common pattern in technical
frameworks, but they can also apply in the domain layer.</p>
<p>The name service emphasizes the relationship with other objects. Unlike ENTITIES and VALUE
OBJECTS , it is defined purely in terms of what it can do for a client. A SERVICE tends to be named for
an activity, rather than an entity—a verb rather than a noun. A SERVICE can still have an abstract,
intentional definition; it just has a different flavor than the definition of an object. A SERVICE should
still have a defined responsibility, and that responsibility and the interface fulfilling it should be
defined as part of the domain model. Operation names should come from the UBIQUITOUS
LANGUAGE or be introduced into it. Parameters and results should be domain objects.</p>
<p>SERVICES should be used judiciously and not allowed to strip the ENTITIES and VALUE OBJECTS of all
their behavior. But when an operation is actually an important domain concept, a SERVICE forms a
natural part of a MODEL-DRIVEN DESIGN . Declared in the model as a SERVICE, rather than as a
phony object that doesn&#8217;t actually represent anything, the standalone operation will not mislead
anyone.</p>
<p>A good SERVICE has three characteristics.</p>
<p>1. The operation relates to a domain concept that is not a natural part of an ENTITY or VALUE
OBJECT .
2. The interface is defined in terms of other elements of the domain model.
3. The operation is stateless.</p>
<p>Statelessness here means that any client can use any instance of a particular SERVICE without
regard to the instance&#8217;s individual history. The execution of a SERVICE will use information that is
accessible globally, and may even change that global information (that is, it may have side
effects). But the SERVICE does not hold state of its own that affects its own behavior, as most
domain objects do.</p>
<p>When a significant process or transformation in the domain is not a natural
responsibility of an ENTITY or VALUE OBJECT, add an operation to the model as a
standalone interface declared as a SERVICE. Define the interface in terms of the
language of the model and make sure the operation name is part of the UBIQUITOUS
LANGUAGE. Make the SERVICE stateless.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id17">[4]</a></p>
</div></blockquote>
</div>
<div class="section" id="service-types-by-layers-of-logic">
<h1><a class="toc-backref" href="#id64">Service types  by layers of logic</a><a class="headerlink" href="#service-types-by-layers-of-logic" title="Permalink to this headline">¶</a></h1>
<p>Eric Evans divides Services into three layers of logic:</p>
<blockquote>
<div><p>Partitioning Services into Layers</p>
<dl class="docutils">
<dt>Application</dt>
<dd><p class="first">Funds Transfer App Service</p>
<ul class="last simple">
<li>Digests input (such as an XML request).</li>
<li>Sends message to domain service for fulfillment.</li>
<li>Listens for confirmation.</li>
<li>Decides to send notification using infrastructure service.</li>
</ul>
</dd>
<dt>Domain</dt>
<dd><p class="first">Funds Transfer Domain Service</p>
<ul class="last simple">
<li>Interacts with necessary Account and Ledger objects, making appropriate debits and credits.</li>
<li>Supplies confirmation of result (transfer allowed or not, and so on).</li>
</ul>
</dd>
<dt>Infrastructure Send Notification Service</dt>
<dd>Sends e-mails, letters, and other communications as directed by the application.</dd>
</dl>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id18">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>Most SERVICES discussed in the literature are purely technical and belong in the infrastructure layer.
Domain and application SERVICES collaborate with these infrastructure SERVICES.
For example, a bank might have an application that sends an e-mail to a customer when an account balance falls below a specific threshold.
The interface that encapsulates the e-mail system, and perhaps alternate means of notification, is a SERVICE in the infrastructure layer.</p>
<p>It can be harder to distinguish application SERVICES from domain SERVICES.
The application layer is responsible for ordering the notification.
The domain layer is responsible for determining if a threshold was met—though this task probably does not call for a SERVICE, because it would fit the responsibility of an &#8220;account&#8221; object.
That banking application could be responsible for funds transfers.
If a SERVICE were devised to make appropriate debits and credits for a funds transfer,that capability would belong in the domain layer.
Funds transfer has a meaning in the banking domain language, and it involves fundamental business logic.
Technical SERVICES should lack any business meaning at all.</p>
<p>Many domain or application SERVICES are built on top of the populations of ENTITIES and VALUES, behaving like scripts that organize the potential of the domain to actually get something done.
ENTITIES and VALUE OBJECTS are often too fine-grained to provide a convenient access to the capabilities of the domain layer.
Here we encounter a very fine line between the domain layer and the application layer.
For example, if the banking application can convert and export our transactions into a spreadsheet file for us to analyze, that export is an application SERVICE.
There is no meaning of &#8220;file formats&#8221; in the domain of banking, and there are no business rules involved.</p>
<p>On the other hand, a feature that can transfer funds from one account to another is a domain SERVICE because it embeds significant business rules (crediting and debiting the appropriate accounts, for example) and because a &#8220;funds transfer&#8221; is a meaningful banking term.
In this case, the SERVICE does not do much on its own; it would ask the two Account objects to do most of the work.
But to put the &#8220;transfer&#8221; operation on the Account object would be awkward, because the operation involves two accounts and some global rules.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id19">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>Domain Models (116) are preferable to Transaction Scripts (110) for avoiding domain logic duplication and
for managing complexity using classical design patterns.
But putting application logic into pure domain object classes has a couple of undesirable consequences.
First, domain object classes are less reusable across applications if they implement application-specific logic and depend on application-specific packages.
Second, commingling both kinds of logic in the same classes makes it harder to reimplement the application
logic in, say, a workflow tool if that should ever become desirable.
For these reasons Service Layer factors each kind of business logic into a separate layer, yielding the usual benefits of layering and rendering the pure domain object classes more reusable from application to application.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id20">[3]</a></p>
</div></blockquote>
<div class="section" id="domain-service">
<h2><a class="toc-backref" href="#id65">Domain Service</a><a class="headerlink" href="#domain-service" title="Permalink to this headline">¶</a></h2>
<p>Higher-level policies belong to Domain Logic, so we start with it.
Fortunately, this is not the most numerous type of Services.</p>
<p>In detail, the topic of Domain Services and the reasons for their existence  are revealed Vaughn Vernon:</p>
<blockquote>
<div><p>Further, don’t confuse a Domain Service with an Application Service.
We don’t want to house business logic in an Application Service, but we do want business logic housed in a Domain Service.
If you are confused about the difference, compare with Application.
Briefly, to differentiate the two, an Application Service, being the natural client of the domain model, would normally be the client of a Domain Service.
You’ll see that demonstrated later in the chapter.
Just because a Domain Service has the word service in its name does not mean that it is required to be a coarse-grained, remote-capable, heavyweight transactional operation.</p>
<p>...</p>
<p>You can use a Domain Service to</p>
<ul class="simple">
<li>Perform a significant business process</li>
<li>Transform a domain object from one composition to another</li>
<li>Calculate a Value requiring input from more than one domain object</li>
</ul>
<p>- &#8220;Implementing Domain-Driven Design&#8221; by Vaughn Vernon</p>
</div></blockquote>
</div>
<div class="section" id="application-service">
<h2><a class="toc-backref" href="#id66">Application Service</a><a class="headerlink" href="#application-service" title="Permalink to this headline">¶</a></h2>
<p>This is the most numerous type of Services.
Application Services are also known as Service Layer.</p>
</div>
<div class="section" id="infrastructure-service">
<h2><a class="toc-backref" href="#id67">Infrastructure Service</a><a class="headerlink" href="#infrastructure-service" title="Permalink to this headline">¶</a></h2>
<p>Infrastructure Service should be separate of other types of Service.</p>
<blockquote>
<div><p>The infrastructure layer usually does not initiate action in the domain layer. Being &#8220;below&#8221; the
domain layer, it should have no specific knowledge of the domain it is serving. Indeed, such
technical capabilities are most often offered as SERVICES . For example, if an application needs to
send an e-mail, some message-sending interface can be located in the infrastructure layer and the
application layer elements can request the transmission of the message. This decoupling gives
some extra versatility. The message-sending interface might be connected to an e-mail sender, a
fax sender, or whatever else is available. But the main benefit is simplifying the application layer,
keeping it narrowly focused on its job: knowing when to send a message, but not burdened with
how.</p>
<p>The application and domain layers call on the SERVICES provided by the infrastructure layer. When
the scope of a SERVICE has been well chosen and its interface well designed, the caller can remain
loosely coupled and uncomplicated by the elaborate behavior the SERVICE interface encapsulates.</p>
<p>But not all infrastructure comes in the form of SERVICES callable from the higher layers. Some
technical components are designed to directly support the basic functions of other layers (such as
providing an abstract base class for all domain objects) and provide the mechanisms for them to
relate (such as implementations of MVC and the like). Such an &#8220;architectural framework&#8221; has
much more impact on the design of the other parts of the program.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id21">[4]</a></p>
</div></blockquote>
<blockquote>
<div><p>Infrastructure Layer - Provides generic technical capabilities that support the higher layers:
message sending for the application, persistence for the domain, drawing
widgets for the UI, and so on. The infrastructure layer may also support
the pattern of interactions between the four layers through an
architectural framework.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id22">[4]</a></p>
</div></blockquote>
</div>
</div>
<div class="section" id="service-types-by-collaboration">
<h1><a class="toc-backref" href="#id68">Service types by collaboration</a><a class="headerlink" href="#service-types-by-collaboration" title="Permalink to this headline">¶</a></h1>
<p>By collaboration of interaction the Services are divided into <a class="reference external" href="https://en.wikipedia.org/wiki/Orchestration_(computing)">Orchestration</a> Service (&#8220;request/response&#8221;, i.e. the service is aware of the interface of other Services) and <a class="reference external" href="https://en.wikipedia.org/wiki/Service_choreography">Choreography</a> Service (Event-Driven, т.е. loosely coupled) <a class="footnote-reference" href="#fnbm" id="id23">[8]</a>.
Them are two idiomatic styles of collaboration.
The main drawback of the first one is a high awareness of the interface of other Services, i.e. High coupling, which reduces its reuse.
The last one is a variation of the Command pattern, and is used commonly in Event-Driven Architecture (in particular, in CQRS and Event Sourcing applications; a reducer in Redux is a good example), and in DDD applications (a subscriber of Domain/Integration Event).</p>
<blockquote>
<div><p>With orchestration, we rely on a central brain to guide and drive the process, much like the conductor in an orchestra. With choreography, we inform each part of the system of its job, and let it work out the details, like dancers all finding their way and reacting to others around them in a ballet.</p>
<p>&lt;...&gt;</p>
<p>The downside to this orchestration approach is that the customer service can become too much of a central governing authority. It can become the hub in the middle of a web, and a central point where logic starts to live.
I have seen this approach result in a small number of smart “god” services telling anemic CRUD-based services what to do.</p>
<p>With a choreographed approach, we could instead just have the customer service emit an event in an asynchronous manner, saying Customer created.
The email service, postal service, and loyalty points bank then just subscribe to these events and react accordingly, as in Figure 4-4.
This approach is significantly more decoupled.
If some other service needed to reach to the creation of a customer, it just needs to subscribe to the events and do its job when needed.
The downside is that the explicit view of the business process we see in Figure 4-2 is now only implicitly reflected in our system.</p>
<p>- &#8220;Building Microservices. Designing Fine-Grained Systems&#8221; <a class="footnote-reference" href="#fnbm" id="id24">[8]</a> by Sam Newman</p>
</div></blockquote>
<div class="section" id="orchestration-service">
<h2><a class="toc-backref" href="#id69">Orchestration Service</a><a class="headerlink" href="#orchestration-service" title="Permalink to this headline">¶</a></h2>
<p>Orchestration Service is known as Service Layer and is cosidered in more detail below.</p>
</div>
<div class="section" id="choreography-service">
<h2><a class="toc-backref" href="#id70">Choreography Service</a><a class="headerlink" href="#choreography-service" title="Permalink to this headline">¶</a></h2>
<p>There is an interesting article &#8220;<a class="reference external" href="http://udidahan.com/2009/12/09/clarified-cqrs/">Clarified CQRS</a>&#8221; by Udi Dahan, cited by Martin Fowler in his article &#8220;<a class="reference external" href="https://martinfowler.com/bliki/CQRS.html">CQRS</a>&#8221;.</p>
<p>And this article has an interesting point.</p>
<blockquote>
<div><p>The reason you don’t see this layer explicitly represented in CQRS is that it isn’t really there...</p>
<p>- &#8220;Clarified CQRS&#8221; by Udi Dahan</p>
</div></blockquote>
<p>In fact, a command handler is a Service, but an event-driven one that follows a given interface.
It should contain Application Logic (not Business Logic).</p>
<blockquote>
<div><p>Our command processing objects in the various autonomous components actually make up our service layer.</p>
<p>- &#8220;Clarified CQRS&#8221; by Udi Dahan</p>
</div></blockquote>
<p>Choreography Services can only be at Application Logic, even if it is subscribed to a Domain Event.</p>
<div class="section" id="common-mistakes-of-design-choreography-service">
<h3><a class="toc-backref" href="#id71">Common mistakes of design Choreography Service</a><a class="headerlink" href="#common-mistakes-of-design-choreography-service" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, Orchestration Services proxy calls to Choreographic Services.
This often happens with frontend-developers, for example, when Redux/NgRx is used together with an Angular based application, which uses Services a lot.</p>
<p>Having Low Coupling Event-Driven Choreography Services as Command handlers, it would be a design mistake to try to bind them with the High Coupling classic Orchestration Service (with the only purpose of helping the Application Logic hide them from itself).</p>
<blockquote>
<div><p>Each command is independent of the other, so why should we allow the objects which handle them to depend on each other?</p>
<p>- &#8220;Clarified CQRS&#8221; by Udi Dahan</p>
</div></blockquote>
<p>However, there is a question of awareness of Command handlers and applications about the interface of a specific CQRS implementation.
To align the interfaces, there is an Adapter pattern, which can be provided if necessary.</p>
<p>Another common mistake is placing Business Logic in a Choreography Service and degenerating the behavior of Domain Models.</p>
<p>This leads to the problem Eric Evans talked about:</p>
<blockquote>
<div><p>&#8220;If the framework&#8217;s partitioning conventions pull apart the elements implementing the
conceptual objects, the code no longer reveals the model.</p>
<p>There is only so much partitioning a mind can stitch back together, and if the framework uses
it all up, the domain developers lose their ability to chunk the model into meaningful pieces.&#8221;</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans</p>
</div></blockquote>
<p>In an application with extensive Business Logic, this can significantly degrade the quality of business modeling, and complicate the process of Model Distillation in a process of Knowledge Crunching <a class="footnote-reference" href="#fnddd" id="id25">[4]</a>.
Also, such code acquires signs of &#8220;Divergent Change&#8221; <a class="footnote-reference" href="#fnr" id="id26">[7]</a> and &#8220;Shotgun Surgery&#8221; <a class="footnote-reference" href="#fnr" id="id27">[7]</a>, which greatly complicates elimination of domain modeling mistakes in a process of Evolutionary Design.
Ultimately, this leads to a rapid increase in the cost of code change.</p>
<p>Udi Dahan in his article allows the use of <a class="reference external" href="https://martinfowler.com/eaaCatalog/transactionScript.html">Transaction Script</a> to organize Business Logic.
In this case, the choice between Transaction Script и <a class="reference external" href="https://martinfowler.com/eaaCatalog/domainModel.html">Domain Model</a> is considered in detail in &#8220;Patterns of Enterprise Application Architecture&#8221; by M. Fowler and others.
Transaction Script may be appropriate when an application uses Redux together with GraphQL to minimize network traffic.
If an application uses the REST-API and has extensive Business Logic, the use of the Domain Model and DDD will be more appropriate.</p>
</div>
</div>
</div>
<div class="section" id="service-types-by-communication">
<h1><a class="toc-backref" href="#id72">Service types by communication</a><a class="headerlink" href="#service-types-by-communication" title="Permalink to this headline">¶</a></h1>
<p>By communication, Services are divided into Synchronous and Asynchronous.</p>
</div>
<div class="section" id="service-types-by-state">
<h1><a class="toc-backref" href="#id73">Service types by state</a><a class="headerlink" href="#service-types-by-state" title="Permalink to this headline">¶</a></h1>
<div class="section" id="stateless-service">
<h2><a class="toc-backref" href="#id74">Stateless Service</a><a class="headerlink" href="#stateless-service" title="Permalink to this headline">¶</a></h2>
<p>Typically, most Services are stateless.
They are well known, and there is nothing to add.</p>
</div>
<div class="section" id="statefull-service">
<h2><a class="toc-backref" href="#id75">Statefull Service</a><a class="headerlink" href="#statefull-service" title="Permalink to this headline">¶</a></h2>
<p>The UseCases/Interactors <a class="footnote-reference" href="#fncarch" id="id28">[2]</a> classes are a variation of the Command pattern, and can be considered as a Statefull Service.</p>
<p>Eric Evans has a similar idea:</p>
<blockquote>
<div><p>We might like to create a Funds Transfer object to represent the two entries plus the rules and history around the transfer. But we are still left with calls to SERVICES in the interbank networks.
What&#8217;s more, in most development systems, it is awkward to make a direct interface between a domain object and external resources. We can dress up such external SERVICES with a FACADE that takes inputs in terms of the model, perhaps returning a Funds Transfer object as its result.
But whatever intermediaries we might have, and even though they don&#8217;t belong to us, those SERVICES are carrying out the domain responsibility of funds transfer.</p>
<p>- &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; <a class="footnote-reference" href="#fnddd" id="id29">[4]</a></p>
</div></blockquote>
<p>And Randy Stafford with Martin Fowler too:</p>
<blockquote>
<div><p>The two basic implementation variations are the domain facade approach and the operation script approach. In
the domain facade approach a Service Layer is implemented as a set of thin facades over a Domain Model
(116). The classes implementing the facades don&#8217;t implement any business logic. Rather, the Domain Model
(116) implements all of the business logic. The thin facades establish a boundary and set of operations through
which client layers interact with the application, exhibiting the defining characteristics of Service Layer.</p>
<p>In the operation script approach a Service Layer is implemented as a set of thicker classes that directly
implement application logic but delegate to encapsulated domain object classes for domain logic. The
operations available to clients of a Service Layer are implemented as scripts, organized several to a class
defining a subject area of related logic. Each such class forms an application &#8220;service,&#8221; and it&#8217;s common for
service type names to end with &#8220;Service.&#8221; A Service Layer is comprised of these application service classes,
which should extend a Layer Supertype (475), abstracting their responsibilities and common behaviors.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id30">[3]</a> by Martin Fowler, Randy Stafford</p>
</div></blockquote>
<p>Notice, he used the term &#8220;<a class="reference external" href="https://martinfowler.com/eaaCatalog/domainModel.html">Domain Model</a>&#8221;.
These guys are the last of those who can confuse &#8220;<a class="reference external" href="https://martinfowler.com/eaaCatalog/domainModel.html">Domain Model</a>&#8221; and &#8220;<a class="reference external" href="http://martinfowler.com/eaaCatalog/dataMapper.html">DataMapper</a>&#8221;, especially with so many editors and reviewers.
A client expects an interface from the domain model that it does not implement and should not implement for some reason (usually the Single Responsibility Principle).
On the other hand, the client can not implement this behavior itself, as this would lead to &#8220;G14: Feature Envy&#8221; <a class="footnote-reference" href="#fnccode" id="id31">[1]</a>.
There is an Adapter (aka Wrapper) pattern for interface alignment, see &#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; <a class="footnote-reference" href="#fngof" id="id32">[6]</a>.
Statefull Service differs from the usual Adapter pattern only in that it contains lower-level logic, i.e. Application Logic, rather than Business Logic of Domain Model.</p>
<p>This approach reminds me of &#8220;Cross-Cutting Concerns&#8221; <a class="footnote-reference" href="#fnccode" id="id33">[1]</a>, with the only difference being that &#8220;Cross-Cutting Concerns&#8221; implements the interface of the original object (delegate), while domain facade complements it.
When a wrapper implements the interface of the original object, it is usually called Aspect or Decorator.
Often in such cases the term Proxy is used, but, in fact, the Proxy pattern has a slightly different purpose.
This approach is often used to provide the Domain Model with the logic of access to related objects, while keeping the Domain Model completely &#8220;clean&#8221;, i.e. separated from the behavior of lower level logic.</p>
<p>When I was working with legacy code, I saw swollen Domain Models with a huge number of methods (I met up to several hundred methods).
If you analyze such models, you can often find extrinsical responsibilities in the class.
As you know, size of a class is measured by amount of its responsibilities.
Statefull Service and Adapter pattern are a good alternative to remove extrinsical responsibilities from a model and make swollen models lose weight.</p>
</div>
</div>
<div class="section" id="destination-of-service-layer">
<h1><a class="toc-backref" href="#id76">Destination of Service Layer</a><a class="headerlink" href="#destination-of-service-layer" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>A Service Layer defines an application&#8217;s boundary with a layer of services that establishes a set of available
operations and coordinates the application&#8217;s response in each operation.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id34">[3]</a></p>
</div></blockquote>
<blockquote>
<div><p>Enterprise applications typically require different kinds of interfaces to the data they store and the logic they implement: data loaders, user interfaces, integration gateways, and others.
Despite their different purposes, these interfaces often need common interactions with the application to access and manipulate its data and invoke its business logic.
The interactions may be complex, involving transactions across multiple resources and the coordination of several responses to an action.
Encoding the logic of the interactions separately in each interface causes a lot of duplication.</p>
<p>A Service Layer defines an application&#8217;s boundary and its set of available operations from the perspective of interfacing client layers.
It encapsulates the application&#8217;s business logic, controlling transactions and coordinating responses in the implementation of its operations.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id35">[3]</a></p>
</div></blockquote>
<blockquote>
<div><p>The benefit of Service Layer is that it defines a common set of application operations available to many kinds
of clients and it coordinates an application&#8217;s response in each operation. The response may involve application
logic that needs to be transacted atomically across multiple transactional resources. Thus, in an application
with more than one kind of client of its business logic, and complex responses in its use cases involving
multiple transactional resources, it makes a lot of sense to include a Service Layer with container-managed
transactions, even in an undistributed architecture.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id36">[3]</a></p>
</div></blockquote>
<blockquote>
<div><p>A common approach in handling domain logic is to split the domain layer in two. A Service Layer (133) is
placed over an underlying Domain Model (116) or Table Module (125). Usually you only get this with a
Domain Model (116) or Table Module (125) since a domain layer that uses only Transaction Script (110) isn&#8217;t
complex enough to warrant a separate layer. The presentation logic interacts with the domain purely through
the Service Layer (133), which acts as an API for the application.</p>
<p>As well as providing a clear API, the Service Layer (133) is also a good spot to place such things as
transaction control and security. This gives you a simple model of taking each method in the Service Layer
(133) and describing its transactional and security characteristics. A separate properties file is a common
choice for this, but .NET&#8217;s attributes provide a nice way of doing it directly in the code.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id37">[3]</a></p>
</div></blockquote>
<p>Traditionally <a class="reference external" href="https://martinfowler.com/eaaCatalog/serviceLayer.html">Service Layer</a> is an Application layer logic.
This implies that level of Service Layer is lower than level of Domain Layer (i.e. layer of real world objects, which is also called &#8220;business rules&#8221;).
This means that the objects of the Domain Layer should not be aware of the Service Layer.</p>
<p>In addition to the above, the Service Layer can carry the following responsibilities:</p>
<ul class="simple">
<li>To combine the parts of an atomic operation (for example, application should save the data to several storages, e.g. database, redis, file system within a single business transaction or should roll back all).</li>
<li>To hide the data source (here it duplicates the responsibility of the pattern <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a>) and can be omitted if there are no other reasons.</li>
<li>To aggregate the application level operations that are being reused by several clients (for example, some part of application-level logic is used in several different controllers).</li>
<li>As basis for implementation of <a class="reference external" href="https://www.martinfowler.com/eaaCatalog/remoteFacade.html">Remote Facade</a>.</li>
<li>When you have a large controller method, you have to do decomposition. Thus, you apply <a class="reference external" href="https://www.refactoring.com/catalog/extractMethod.html">Extract Method</a> to separate each responsibility into own method. When you did it, you found that the class lost its focus. The quantity of methods has been increased that means the <a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Cohesion</a> (i.e. coefficient of sharing the class&#8217; properties by the class&#8217; methods) has been reduced. To restore the <a class="reference external" href="http://wiki.c2.com/?CouplingAndCohesion">Cohesion</a> you have to extraсt these methods into separate <a class="reference external" href="https://www.refactoring.com/catalog/replaceMethodWithMethodObject.html">Method Object</a>, which can be used as a Service Layer.</li>
<li>The Service Layer can be used as an aggregator for queries if it is over the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern and uses the <a class="reference external" href="http://martinfowler.com/eaaCatalog/queryObject.html">Query object</a> pattern. The fact is that the Repository pattern limits its interface using the Query Object interface. And since class does not have to make assumptions about its clients, it is impossible to accumulate pre-defined queries in the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> class, because it can not be aware about the all needs of all clients. Clients should take care of themselves. But the Service Layer was created for client service. Therefore, it&#8217;s a responsibility of the Service Layer.</li>
</ul>
<p>In other cases, the logic of the Service Layer can be placed directly at the application level (usually a controller).</p>
</div>
<div class="section" id="when-not-to-use-service-layer">
<h1><a class="toc-backref" href="#id77">When not to use Service Layer?</a><a class="headerlink" href="#when-not-to-use-service-layer" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The easier question to answer is probably when not to use it. You probably don&#8217;t need a Service Layer if your
application&#8217;s business logic will only have one kind of client say, a user interface and its use case responses
don&#8217;t involve multiple transactional resources. In this case your Page Controllers can manually control
transactions and coordinate whatever response is required, perhaps delegating directly to the Data Source
layer.
But as soon as you envision a second kind of client, or a second transactional resource in use case responses, it
pays to design in a Service Layer from the beginning.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id38">[3]</a></p>
</div></blockquote>
<p>However, the widely held view that access to the model should always be made through the Service Layer:</p>
<blockquote>
<div><p>My preference is thus to have the thinnest Service Layer (133) you can, if you even need one. My usual
approach is to assume that I don&#8217;t need one and only add it if it seems that the application needs it. However, I
know many good designers who always use a Service Layer (133) with a fair bit of logic, so feel free to ignore
me on this one.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id39">[3]</a></p>
</div></blockquote>
<blockquote>
<div><p>The idea of splitting a services layer from a domain layer is based on a separation of workflow logic from
pure domain logic. The services layer typically includes logic that&#8217;s particular to a single use case and also
some communication with other infrastructures, such as messaging. Whether to have separate services and
domain layers is a matter some debate. I tend to look as it as occasionally useful rather than mandatory, but
designers I respect disagree with me on this.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id40">[3]</a></p>
</div></blockquote>
</div>
<div class="section" id="service-is-not-a-wrapper-for-data-mapper">
<h1><a class="toc-backref" href="#id78">Service is not a wrapper for Data Mapper</a><a class="headerlink" href="#service-is-not-a-wrapper-for-data-mapper" title="Permalink to this headline">¶</a></h1>
<p>Often <a class="reference external" href="https://martinfowler.com/eaaCatalog/serviceLayer.html">Service Layer</a> is mistakenly made in the for of wrapper over <a class="reference external" href="http://martinfowler.com/eaaCatalog/dataMapper.html">DataMapper</a>.
This is not quite the right decision.
A Data Mapper serves a Domain Model, a Repository serves an Aggregate <a class="footnote-reference" href="#fnnetmsa" id="id41">[9]</a>, but a Service serves a client (or a client group).
The Service Layer can manipulate multiple Data Mappers, Repositories, other Services within a business transaction and in favour of a client.
Therefore, Service&#8217;s methods usually contain name of the returned Domain Model as a suffix (for example, getUser()), while methods of a Data Mapper (or a Repository) do not need such suffix (since the Domain name is already present in name of the Data Mapper class, and the Data Mapper serves only one Domain Model).</p>
<blockquote>
<div><p>Identifying the operations needed on a Service Layer boundary is pretty straightforward. They&#8217;re determined
by the needs of Service Layer clients, the most significant (and first) of which is typically a user interface.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id42">[3]</a></p>
</div></blockquote>
</div>
<div class="section" id="implementation-of-service-layer">
<h1><a class="toc-backref" href="#id79">Implementation of Service Layer</a><a class="headerlink" href="#implementation-of-service-layer" title="Permalink to this headline">¶</a></h1>
<p>There is a few examples of Service Layer implementations:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/in2it/zfdemo/blob/master/application/modules/user/services/User.php">https://github.com/in2it/zfdemo/blob/master/application/modules/user/services/User.php</a></li>
<li><a class="reference external" href="https://framework.zend.com/manual/2.4/en/in-depth-guide/services-and-servicemanager.html">https://framework.zend.com/manual/2.4/en/in-depth-guide/services-and-servicemanager.html</a></li>
<li><a class="reference external" href="https://framework.zend.com/manual/2.4/en/user-guide/database-and-models.html#using-servicemanager-to-configure-the-table-gateway-and-inject-into-the-albumtable">https://framework.zend.com/manual/2.4/en/user-guide/database-and-models.html#using-servicemanager-to-configure-the-table-gateway-and-inject-into-the-albumtable</a></li>
<li><a class="reference external" href="https://github.com/zendframework/zf2-tutorial/blob/master/module/Album/src/Album/Model/AlbumTable.php">https://github.com/zendframework/zf2-tutorial/blob/master/module/Album/src/Album/Model/AlbumTable.php</a></li>
</ul>
</div>
<div class="section" id="inversion-of-control">
<h1><a class="toc-backref" href="#id80">Inversion of control</a><a class="headerlink" href="#inversion-of-control" title="Permalink to this headline">¶</a></h1>
<p>Use Inversion of control, desirable in the form of Passive <a class="footnote-reference" href="#fnccode" id="id43">[1]</a> &#8220;<a class="reference external" href="https://martinfowler.com/articles/injection.html">Dependency Injection</a>&#8221; (DI).</p>
<blockquote>
<div>True Dependency Injection goes one step further. The class takes no direct steps to
resolve its dependencies; it is completely passive. Instead, it provides setter methods or
constructor arguments (or both) that are used to inject the dependencies. During the con-
struction process, the DI container instantiates the required objects (usually on demand)
and uses the constructor arguments or setter methods provided to wire together the depen-
dencies. Which dependent objects are actually used is specified through a configuration
file or programmatically in a special-purpose construction module.
&#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; <a class="footnote-reference" href="#fnccode" id="id44">[1]</a></div></blockquote>
<p>One of the main responsibilities of Service Layer is the hiding of data source.
It allows you to use <a class="reference external" href="https://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a> for testing.
The same approach can be used for parallel development, when the implementation of the Service Layer is not ready yet.
Sometimes it is useful to replace the Service with a fake data generator.
In general, the Service Layer will be of little use if it is not possible to substitute it (or to substitute the dependencies used by it).</p>
</div>
<div class="section" id="widespread-problem-of-django-applications">
<h1><a class="toc-backref" href="#id81">Widespread problem of Django applications</a><a class="headerlink" href="#widespread-problem-of-django-applications" title="Permalink to this headline">¶</a></h1>
<p>A common mistake is to use the django.db.models.Manager class (and even django.db.models.Model) as a Service Layer.
Often you can see how some method of the class django.db.models.Model takes as an argument the HTTP-request object django.http.request.HttpRequest, for example, to check the permissions.</p>
<p>The HTTP request object is the Application Layer logic, while the model class is the logic of the Domain Layer, i.e. objects of the real world, which are also called business rules.
Checking permissions is also the logic of Application Layer.</p>
<p>The lower layer should not be aware of the higher layer.
Domain-level logic should not be aware of application-level logic.</p>
<p>The class django.db.models.Manager corresponds most closely to the class Finder described in &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id45">[3]</a>.</p>
<blockquote>
<div><p>With a Row Data Gateway you&#8217;re faced with the questions of where to put the find operations that generate this
pattern. You can use static find methods, but they preclude polymorphism should you want to substitute
different finder methods for different data sources. In this case it often makes sense to have separate finder
objects so that each table in a relational database will have one finder class and one gateway class for the results.</p>
<p>It&#8217;s often hard to tell the difference between a Row Data Gateway and an Active Record (160). The crux of the
matter is whether there&#8217;s any domain logic present; if there is, you have an Active Record (160). A Row Data
Gateway should contain only database access logic and no domain logic.</p>
<p>- Chapter 10. &#8220;Data Source Architectural Patterns : Row Data Gateway&#8221;, &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id46">[3]</a></p>
</div></blockquote>
<p>Although Django does not use the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">Repository</a> pattern, it uses an abstraction of the selection criteria in the form similar to the <a class="reference external" href="http://martinfowler.com/eaaCatalog/queryObject.html">Query Object</a> pattern.
Like the Repository pattern, the model class (<a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a>) limits its interface using the Query Object interface.
Clients should use the provided interface, rather than impose their responsibilities on the Model and its Manager on knowledge of their queries.
And since class does not have to make assumptions about its clients, it is impossible to accumulate pre-defined queries in the Model class, because it can not be aware about the all needs of all clients.
Clients should take care of themselves.
But the Service Layer was created for client service.
Therefore, it&#8217;s a responsibility of the Service Layer.</p>
<p>Attempts to exclude the Serving Layer from Django applications leads to the appearance of Managers with a lot of methods.</p>
<p>A good practice would be to hide the implementation (in the form of <a class="reference external" href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">ActiveRecord</a>) of Django models by the Service Layer.
This will allow painless ORM replace if necessary.</p>
<blockquote>
<div><p>Some might also argue that the application logic responsibilities could be implemented in domain object
methods, such as Contract.calculateRevenueRecognitions(), or even in the data source layer,
thereby eliminating the need for a separate Service Layer. However, I find those allocations of responsibility
undesirable for a number of reasons. First, domain object classes are less reusable across applications if they
implement application-specific logic (and depend on application-specific Gateways (466), and the like). They
should model the parts of the problem domain that are of interest to the application, which doesn&#8217;t mean all of
application&#8217;s use case responsibilities. Second, encapsulating application logic in a &#8220;higher&#8221; layer
dedicated to that purpose (which the data source layer isn&#8217;t) facilitates changing the implementation of that
layer perhaps to use a workflow engine.</p>
<p>- &#8220;Patterns of Enterprise Application Architecture&#8221; <a class="footnote-reference" href="#fnpoeaa" id="id47">[3]</a></p>
</div></blockquote>
</div>
<div class="section" id="problems-of-django-annotation">
<h1><a class="toc-backref" href="#id82">Problems of Django annotation</a><a class="headerlink" href="#problems-of-django-annotation" title="Permalink to this headline">¶</a></h1>
<p>I often observed the problem when a new field was added to the Django Model, and multiple problems started to occur, since this name was already used either with the annotation interface or with Raw-SQL.
Also, the implementation of annotations by Django ORM makes it impossible to use the pattern <a class="reference external" href="http://martinfowler.com/eaaCatalog/identityMap.html">Identity Map</a>.
Storm ORM / SQLAlchemy implement annotations more successfully.
If you still had to work with Django Model, refrain from using Django annotation mechanism in favor of bare pattern <a class="reference external" href="http://martinfowler.com/eaaCatalog/dataMapper.html">DataMapper</a>.</p>
</div>
<div class="section" id="peculiar-properties-of-service-layer-on-client-side">
<h1><a class="toc-backref" href="#id83">Peculiar properties of Service Layer on client side</a><a class="headerlink" href="#peculiar-properties-of-service-layer-on-client-side" title="Permalink to this headline">¶</a></h1>
<p>Using the <a class="reference external" href="https://martinfowler.com/bliki/DDD_Aggregate.html">Aggregate</a> concept and reactive programming libraries, such as <a class="reference external" href="https://github.com/ReactiveX/rxjs">RxJS</a>, allows us to implement Service Layer using a simplest pattern like <a class="reference external" href="https://martinfowler.com/eaaCatalog/gateway.html">Gateway</a>, see, for example, <a class="reference external" href="https://angular.io/tutorial/toh-pt6">the tutorial of Angular documentation</a>.
In this case, <a class="reference external" href="http://martinfowler.com/eaaCatalog/queryObject.html">Query Object</a> is usually implemented as a simple dictionary, which is then converted to a list of GET parameters for the URL.
Such service usually communicates with a server either through JSON-RPC, or through <a class="reference external" href="http://www.django-rest-framework.org/api-guide/viewsets/#viewset-actions">REST-API Actions</a>.</p>
<p>Everything works well until you need to express prioritized queries, for example, using the logical operator &#8220;OR&#8221; which has a lower priority than the logical operator &#8220;AND&#8221;.
This raises the question of who should be responsible for building the query, the Service Layer of the client or the Service Layer of the server?</p>
<p>On the one hand, the server should not make assumptions about its clients, and must limit its interface through the interface <a class="reference external" href="http://martinfowler.com/eaaCatalog/queryObject.html">Query Object</a>.
But this dramatically increases the level of complexity of the client, in particular, the implementation of <a class="reference external" href="https://martinfowler.com/eaaCatalog/serviceStub.html">Service Stub</a>.
To facilitate implementation, you can use the library <a class="reference external" href="https://github.com/persvr/rql">rql</a> mentioned in the article &#8220;<a class="reference internal" href="../javascript-and-repository-pattern/"><span class="doc">Implementation of Repository pattern for browser&#8217;s JavaScript</span></a>&#8221;.</p>
<p>On the other hand, the Service Layer, albeit a remote call, is designed to serve clients, so it can concentrate the logic of query building.
If the client does not contain complex logic, allowing to interpret the prioritized queries for Service Stub, then no need to complicate it.
In this case, it&#8217;s easier to add a new method to the remote call service, and get rid of the need for prioritized queries.</p>
</div>
<div class="section" id="concurrent-update-issue">
<h1><a class="toc-backref" href="#id84">Concurrent update issue</a><a class="headerlink" href="#concurrent-update-issue" title="Permalink to this headline">¶</a></h1>
<p>The advent of the Internet has provided access to a huge amount of data that is excessively large with the capabilities of the server.
There was a need for scalability and distributed storage and processing of data.</p>
<p>One of the most acute problems is the concurrent update issue.</p>
<blockquote>
<div><p>All race conditions, deadlock conditions, and concurrent update problems are due to mutable variables.
You cannot have a race condition or a concurrent update problem if no variable is ever updated.
You cannot have deadlocks without mutable locks.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id48">[2]</a> by Robert C. Martin</p>
</div></blockquote>
<p>An order is a correct imposition of restrictions.</p>
</div>
<div class="section" id="cqrs">
<h1><a class="toc-backref" href="#id85">CQRS</a><a class="headerlink" href="#cqrs" title="Permalink to this headline">¶</a></h1>
<p>The concurrent update issue can be significantly reduced by restricting bidirectional state changes by introducing unidirectional changes, i.e. by separating reading from writing.
This is exactly the approach used by Redux.</p>
<blockquote>
<div><p>&#8220;it allows us to host the two services differently eg: we can host the read service on 25 servers and the write service on two.
The processing of commands and queries is fundamentally asymmetrical, and scaling the services symmetrically does not make a lot of sense.&#8221;</p>
<p>- &#8220;<a class="reference external" href="http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/">CQRS, Task Based UIs, Event Sourcing agh!</a>&#8221; by Greg Young</p>
</div></blockquote>
<p>Organizing Application Logic and Business Logic is well covered in the article &#8220;<a class="reference external" href="http://udidahan.com/2009/12/09/clarified-cqrs/">Clarified CQRS</a>&#8221; by Udi Dahan.</p>
<p>The use of CQRS facilitates the use of Functional Programming paradigm.</p>
<blockquote>
<div><p>For both theoretical and practical reasons detailed elsewhere [10], the command-query separation principle is a methodological rule, not a language feature, but all serious software developed in Eiffel observes it scrupulously, to great referential transparency advantage.
Although other schools of object-oriented programming regrettable do not apply it (continuing instead the C style of calling functions rather than procedures to achieve changes), but in my view it is a key element of the object-oriented approach.
It seems like a viable way to obtain the referential transparency goal of functional programming — since expressions, which only involve queries, will not change the state, and hence can be understood as in traditional mathematics or a functional language — while acknowledging, through the notion of command, the fundamental role of the concept of state in modeling systems and computations.</p>
<p>- <a class="reference external" href="http://se.ethz.ch/~meyer/publications/functional/meyer_functional_oo.pdf">&#8220;Software architecture: object-oriented vs functional</a>&#8221; by Bertrand Meyer</p>
</div></blockquote>
<p>Functional Programming inherently cannot produce side effects (since Functional Programming imposes a restriction on assignment (mutability)).
This is the reason for its popularity growth in the era of distributed computing.
No mutability - no concurrent update issues.</p>
<p>It is necessary to distinguish the Functional Programming paradigm from the languages supporting this paradigm, since quite often the languages supporting this paradigm allow not to follow it.</p>
<p>However, despite the new opportunities to use Functional Programming in code, the data storage itself (IO device) is still prone to the concurrent update issues, since it has mutable rows, and, therefore, has a side effect.</p>
<p>The solution to this problem is usually to replace CRUD (Create, Read, Update, Delete) with CR, i.e. imposing restrictions on Update and Delete rows in the storage, that is widespread with the name Event Sourcing.
There are specialized storages that implement Event Sourcing, but it can also be implemented without specialized tools.</p>
</div>
<div class="section" id="event-sourcing">
<h1><a class="toc-backref" href="#id86">Event Sourcing</a><a class="headerlink" href="#event-sourcing" title="Permalink to this headline">¶</a></h1>
<p>If CQRS allows working with data storages in the Imperative style, and separates a command (side effect) from a query (reading) data, then Event Sourcing goes even further and imposes a restriction on changing and deleting data, turning CRUD into CR.
This pattern allows working with data storages in the Functional style, and provides the same benefits: no mutable state - no concurrent update issues.
And the same disadvantages - high memory and processor consumption.
This is the reason why this pattern is widely used in distributed systems, where there is an acute need for its advantages, and at the same time, its weaknesses do not appear (since distributed systems are not limited either in memory or in processor power).</p>
<p>A good example of Event Sourcing can be <a class="reference external" href="https://martinfowler.com/eaaDev/AccountingNarrative.html">the principle of organizing a bank account</a> in a database, when the account is not a source of truth, but simply reflects the aggregate value of all transactions (i.e. events).</p>
<p>This topic is well covered in Chapter 6 &#8220;Functional Programming&#8221; of &#8220;Clean Architecture&#8221; by Robert C. Martin.</p>
<blockquote>
<div><p>More importantly, nothing ever gets deleted or updated from such a data store.
As a consequence, our applications are not CRUD; they are just CR. Also, because neither updates nor deletions occur in the data store, there cannot be any concurrent update issues.</p>
<p>If we have enough storage and enough processor power, we can make our applications entirely immutable—and, therefore, <strong>entirely functional</strong>.</p>
<p>If this still sounds absurd, it might help if you remembered that this is precisely the way your source code control system works.</p>
<p>- &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id49">[2]</a> by Robert C. Martin</p>
</div></blockquote>
<blockquote>
<div><p><strong>Event Sourcing is naturally functional.</strong>
It&#8217;s an append only log of facts that have happened in the past.
You can say that any projection any state is a left fold over your previous history.</p>
<p>- Greg Young, &#8220;<a class="reference external" href="https://youtu.be/LDW0QWie21s?t=1004">A Decade of DDD, CQRS, Event Sourcing</a>&#8221; at 16:44</p>
</div></blockquote>
<blockquote>
<div><p>It&#8217;s actually functional.</p>
<p>- Greg Young, &#8220;<a class="reference external" href="https://youtu.be/kZL41SMXWdM?t=2089">Event Sourcing is actually just functional code</a>&#8221; at 34:49</p>
</div></blockquote>
<blockquote>
<div><p>I have always said that Event Sourcing is &#8220;Functional Data Storage&#8221;.
In this talk we will try migrating to a idiomatic functional way of looking at Event Sourcing.
Come and watch all the code disappear!
By the time you leave you will never want an &#8220;Event Sourcing Framework (TM)&#8221; ever again!</p>
<p>- Greg Young, &#8220;<a class="reference external" href="https://vimeo.com/131636650">Functional Data</a>&#8221;, NDC Conferences</p>
</div></blockquote>
</div>
<div class="section" id="further-reading">
<h1><a class="toc-backref" href="#id87">Further Reading</a><a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h1>
<ul>
<li><dl class="first docutils">
<dt>&#8220;Clean Code: A Handbook of Agile Software Craftsmanship&#8221; by Robert C. Martin <a class="footnote-reference" href="#fnccode" id="id50">[1]</a>, chapters:</dt>
<dd><ul class="first last simple">
<li>Dependency Injection ... 157</li>
<li>Cross-Cutting Concerns ... 160</li>
<li>Java Proxies ... 161</li>
<li>Pure Java AOP Frameworks ... 163</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; <a class="footnote-reference" href="#fncarch" id="id51">[2]</a> by Robert C. Martin</dt>
<dd><ul class="first last simple">
<li>Chapter 6 Functional Programming : Event Sourcing</li>
<li>Chapter 16 Independence</li>
<li>Chapter 18 Boundary Anatomy : Services</li>
<li>Chapter 20 Business Rules</li>
<li>Chapter 22 The Clean Architecture</li>
<li>Chapter 34 The Missing Chapter</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Patterns of Enterprise Application Architecture&#8221; by Martin Fowler <a class="footnote-reference" href="#fnpoeaa" id="id52">[3]</a>, chapters:</dt>
<dd><ul class="first last simple">
<li>Part 1. The Narratives : Chapter 2. Organizing Domain Logic : Service Layer</li>
<li>Part 1. The Narratives : Chapter 8. Putting It All Together</li>
<li>Part 2. The Patterns : Chapter 9. Domain Logic Patterns : Service Layer</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans <a class="footnote-reference" href="#fnddd" id="id53">[4]</a>, chapters:</dt>
<dd><ul class="first last simple">
<li>Part II: The Building Blocks of a Model-Driven Design : Chapter Four. Isolating the Domain : Layered Architecture</li>
<li>Part II: The Building Blocks of a Model-Driven Design : Chapter Five. A Model Expressed in Software : Services</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Implementing Domain-Driven Design&#8221; <a class="footnote-reference" href="#fniddd" id="id54">[5]</a> by Vaughn Vernon</dt>
<dd><ul class="first last simple">
<li>Chapter 4 Architecture : Command-Query Responsibility Segregation, or CQRS</li>
<li>Chapter 4 Architecture : Event-Driven Architecture : Long-Running Processes, aka Sagas</li>
<li>Chapter 4 Architecture : Event-Driven Architecture : Event Sourcing</li>
<li>Chapter 7 Services</li>
<li>Chapter 14 Application : Application Services</li>
<li>Appendix A Aggregates and Event Sourcing: A+ES : Inside an Application Service</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;<a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ff650706(v=pandp.10)?redirectedfrom=MSDN">Microsoft Application Architecture Guide</a>&#8221; 2nd Edition (Patterns &amp; Practices) by Microsoft Corporation (J.D. Meier, David Hill, Alex Homer, Jason Taylor, Prashant Bansode, Lonnie Wall, Rob Boucher Jr., Akshay Bogawat), chapters:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658109%28v%3dpandp.10%29">Chapter 5: Layered Application Guidelines</a> ... 55</li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658109%28v%3dpandp.10%29#services-layer">Chapter 5: Layered Application Guidelines : Services and Layers</a> ... 58</li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658090%28v%3dpandp.10%29">Chapter 9: Service Layer Guidelines</a> ... 115</li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658105%28v%3dpandp.10%29">Chapter 17: Crosscutting Concerns</a> ... 205</li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658099%28v%3dpandp.10%29#service-layer">Chapter 21: Designing Web Applications : Service Layer</a> ... 288</li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658114%28v%3dpandp.10%29#service-layer">Chapter 25: Designing Service Applications : Service Layer</a> ... 371</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Microsoft .NET: Architecting Applications for the Enterprise&#8221; 2nd Edition by Dino Esposito, Andrea Saltarello, chapters:</dt>
<dd><ul class="first last simple">
<li>Chapter 5 Discovering the domain architecture : The layered architecture ... 129</li>
<li>Chapter 10 Introducing CQRS ... 255</li>
<li>Chapter 11 Implementing CQRS ... 291</li>
<li>Chapter 12 Introducing event sourcing ... 311</li>
<li>Chapter 13 Implementing event sourcing ... 325</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; by Erich Gamma <a class="footnote-reference" href="#fngof" id="id55">[6]</a>, chapters:</dt>
<dd><ul class="first last simple">
<li>Design Pattern Catalog : 4 Structural Patterns : Adapter ... 139</li>
<li>Design Pattern Catalog : 4 Structural Patterns : Decorator ... 175</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Building Microservices. Designing Fine-Grained Systems&#8221; by Sam Newman, chapters:</dt>
<dd><ul class="first last simple">
<li>Chapter 3 How to Model Services : Premature Decomposition ... 33</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Monolith to Microservices Evolutionary Patterns to Transform Your Monolith&#8221; by Sam Newman</dt>
<dd><ul class="first last simple">
<li>Chapter 4. Decomposing the Database : Sagas</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;<a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/">Cloud Design Patterns. Prescriptive architecture guidance for cloud applications</a>&#8221; by Alex Homer, John Sharp, Larry Brader, Masashi Narumoto, Trent Swanson, chapters:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cqrs">Command and Query Responsibility Segregation (CQRS) pattern</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/event-sourcing">Event Sourcing pattern</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/compensating-transaction">Compensating Transaction pattern</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;<a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/index">.NET Microservices: Architecture for Containerized .NET Applications</a>&#8221; edition v2.2.1 (<a class="reference external" href="https://aka.ms/microservicesebook">mirror</a>) by Cesar de la Torre, Bill Wagner, Mike Rousos, chapters:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/">Tackle Business Complexity in a Microservice with DDD and CQRS Patterns</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns">Apply simplified CQRS and DDD patterns in a microservice</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/eshoponcontainers-cqrs-ddd-microservice">Apply CQRS and CQS approaches in a DDD microservice in eShopOnContainers</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/cqrs-microservice-reads">Implement reads/queries in a CQRS microservice</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;<a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj554200(v=pandp.10)">CQRS Journey</a>&#8221; by Dominic Betts, Julián Domínguez, Grigori Melnik, Fernando Simonazzi, Mani Subramanian, chapters:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj591560(v=pandp.10)">Reference 1: CQRS in Context</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj591573(v=pandp.10)">Reference 2: Introducing the Command Query Responsibility Segregation Pattern</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj591559(v=pandp.10)">Reference 3: Introducing Event Sourcing</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj591577(v=pandp.10)">Reference 4: A CQRS and ES Deep Dive</a></li>
<li><a class="reference external" href="https://docs.microsoft.com/en-US/previous-versions/msp-n-p/jj591569(v=pandp.10)">Reference 6: A Saga on Sagas</a></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;Enterprise Integration Patterns: Designing, Building, and Deploying Messaging Solutions&#8221; by Gregor Hohpe, Bobby Woolf, chapters:</dt>
<dd><ul class="first last simple">
<li><ol class="first arabic" start="7">
<li>Message routing : Process manager ... 278</li>
</ol>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>&#8220;<a class="reference external" href="https://microservices.io/patterns/index.html">Microservices Patterns: With examples in Java</a>&#8221; 1st Edition by Chris Richardson</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://microservices.io/patterns/data/cqrs.html">Pattern: Command Query Responsibility Segregation (CQRS)</a></li>
<li><a class="reference external" href="https://microservices.io/patterns/data/event-sourcing.html">Pattern: Event sourcing</a></li>
<li><a class="reference external" href="https://microservices.io/patterns/data/saga.html">Pattern: Saga</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/bliki/CQRS.html">CQRS</a>&#8220;</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/bliki/CommandQuerySeparation.html">Command Query Separation</a></p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a>&#8220;</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/articles/201701-event-driven.html">What do you mean by &#8220;Event-Driven&#8221;?</a>&#8220;</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/eaaDev/AccountingNarrative.html">Patterns for Accounting</a>&#8220;</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://martinfowler.com/apsupp/accounting.pdf">Accounting Patterns</a>&#8220;</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/">CQRS, Task Based UIs, Event Sourcing agh!</a>&#8221; by Greg Young</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="http://udidahan.com/2009/12/09/clarified-cqrs/">Clarified CQRS</a>&#8221; by Udi Dahan</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf">CQRS Documents</a>&#8221; by Greg Young</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="http://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf">Sagas</a>&#8221; by Hector Garcia-Molina and Kenneth Salem</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://enterprisecraftsmanship.com/posts/domain-vs-application-services/">Domain services vs Application services</a>&#8221; by Vladimir Khorikov</p>
</li>
<li><p class="first">&#8220;<a class="reference external" href="https://vasters.com/archive/Sagas.html">Sagas</a>&#8221; by Clemens Vasters (&#8220;<a class="reference external" href="https://gist.github.com/clemensv/3562597">Sample Code</a>&#8221;)</p>
</li>
</ul>
<p>Эта статья на Русском языке &#8220;<a class="reference internal" href="../../ru/service-layer/"><span class="doc">Проектирование Сервисного Слоя и Логики Приложения</span></a>&#8221;.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fnccode" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id31">1</a>, <a class="fn-backref" href="#id33">2</a>, <a class="fn-backref" href="#id43">3</a>, <a class="fn-backref" href="#id44">4</a>, <a class="fn-backref" href="#id50">5</a>)</em> &#8220;<a class="reference external" href="http://www.informit.com/store/clean-code-a-handbook-of-agile-software-craftsmanship-9780132350884">Clean Code: A Handbook of Agile Software Craftsmanship</a>&#8221; by <a class="reference external" href="http://informit.com/martinseries">Robert C. Martin</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fncarch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id3">2</a>, <a class="fn-backref" href="#id4">3</a>, <a class="fn-backref" href="#id5">4</a>, <a class="fn-backref" href="#id6">5</a>, <a class="fn-backref" href="#id7">6</a>, <a class="fn-backref" href="#id8">7</a>, <a class="fn-backref" href="#id12">8</a>, <a class="fn-backref" href="#id13">9</a>, <a class="fn-backref" href="#id28">10</a>, <a class="fn-backref" href="#id48">11</a>, <a class="fn-backref" href="#id49">12</a>, <a class="fn-backref" href="#id51">13</a>)</em> &#8220;Clean Architecture: A Craftsman&#8217;s Guide to Software Structure and Design&#8221; by Robert C. Martin</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnpoeaa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id9">1</a>, <a class="fn-backref" href="#id10">2</a>, <a class="fn-backref" href="#id11">3</a>, <a class="fn-backref" href="#id14">4</a>, <a class="fn-backref" href="#id15">5</a>, <a class="fn-backref" href="#id20">6</a>, <a class="fn-backref" href="#id30">7</a>, <a class="fn-backref" href="#id34">8</a>, <a class="fn-backref" href="#id35">9</a>, <a class="fn-backref" href="#id36">10</a>, <a class="fn-backref" href="#id37">11</a>, <a class="fn-backref" href="#id38">12</a>, <a class="fn-backref" href="#id39">13</a>, <a class="fn-backref" href="#id40">14</a>, <a class="fn-backref" href="#id42">15</a>, <a class="fn-backref" href="#id45">16</a>, <a class="fn-backref" href="#id46">17</a>, <a class="fn-backref" href="#id47">18</a>, <a class="fn-backref" href="#id52">19</a>)</em> &#8220;<a class="reference external" href="https://www.martinfowler.com/books/eaa.html">Patterns of Enterprise Application Architecture</a>&#8221; by <a class="reference external" href="https://martinfowler.com/aboutMe.html">Martin Fowler</a>, David Rice, Matthew Foemmel, Edward Hieatt, Robert Mee, Randy Stafford</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id16">2</a>, <a class="fn-backref" href="#id17">3</a>, <a class="fn-backref" href="#id18">4</a>, <a class="fn-backref" href="#id19">5</a>, <a class="fn-backref" href="#id21">6</a>, <a class="fn-backref" href="#id22">7</a>, <a class="fn-backref" href="#id25">8</a>, <a class="fn-backref" href="#id29">9</a>, <a class="fn-backref" href="#id53">10</a>)</em> &#8220;Domain-Driven Design: Tackling Complexity in the Heart of Software&#8221; by Eric Evans</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fniddd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id54">[5]</a></td><td>&#8220;Implementing Domain-Driven Design&#8221; by Vaughn Vernon</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fngof" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[6]</td><td><em>(<a class="fn-backref" href="#id32">1</a>, <a class="fn-backref" href="#id55">2</a>)</em> &#8220;Design Patterns Elements of Reusable Object-Oriented Software&#8221; by Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides, 1994</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnr" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[7]</td><td><em>(<a class="fn-backref" href="#id26">1</a>, <a class="fn-backref" href="#id27">2</a>)</em> &#8220;Refactoring: Improving the Design of Existing Code&#8221; by Martin Fowler, Kent Beck, John Brant, William Opdyke, Don Roberts</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnbm" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><em>(<a class="fn-backref" href="#id23">1</a>, <a class="fn-backref" href="#id24">2</a>)</em> &#8220;Building Microservices. Designing Fine-Grained Systems&#8221; by Sam Newman</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="fnnetmsa" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id41">[9]</a></td><td>&#8220;<a class="reference external" href="https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/index">.NET Microservices: Architecture for Containerized .NET Applications</a>&#8221; edition v2.2.1 (<a class="reference external" href="https://aka.ms/microservicesebook">mirror</a>) by Cesar de la Torre, Bill Wagner, Mike Rousos</td></tr>
</tbody>
</table>
<div class="note update admonition">
<p class="first last admonition-title">Updated on Oct 12, 2019</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../how-to-quickly-develop-high-quality-code/">
    <i class="fa fa-arrow-circle-left"></i>
    How to quickly develop high-quality code. Team work.
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../ru/service-layer/">
    Проектирование Сервисного Слоя и Логики Приложения
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'emacsway';
        var disqus_identifier = '/en/service-layer/';
        var disqus_title = 'Design of Service Layer and Application Logic';
        var disqus_url = 'https://emacsway.github.io/en/service-layer/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">@emacsway's blog</h1>
    
  </a>
</p>









  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Jul 17, 2017
  
  </h2>

  <ul>
    
  <li><i class="fa fa-pencil-square-o"></i>
    Oct 12, 2019</li>
  

  
  <li><i class="fa-fw fa fa-user"></i>
    
      
      <a href="../../blog/author/ivan-zakrevsky/">Ivan Zakrevsky</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-language"></i>
    
      
      <a href="../../blog/language/english/">English</a>
      
    </li>
  

  

  
  <li><i class="fa-fw fa fa-tags"></i>
      
    
      
      <a href="../../blog/tag/software-design/">Software Design</a>,
      
    
      
      <a href="../../blog/tag/software-architecture/">Software Architecture</a>,
      
    
      
      <a href="../../blog/tag/orm/">ORM</a>,
      
    
      
      <a href="../../blog/tag/django-model/">Django Model</a>,
      
    
      
      <a href="../../blog/tag/service-layer/">Service Layer</a>,
      
    
      
      <a href="../../blog/tag/redux/">Redux</a>,
      
    
      
      <a href="../../blog/tag/flux/">Flux</a>,
      
    
      
      <a href="../../blog/tag/model/">Model</a>,
      
    
      
      <a href="../../blog/tag/cqrs/">CQRS</a>,
      
    
      
      <a href="../../blog/tag/event-sourcing/">Event Sourcing</a>
      
    </li>
  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emacsway'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/en/service-layer/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul class="simple">
</ul>


<ul>
    
    <li class="toctree-l1"><a href="https://t.me/emacsway_log"><i class="fab fa-telegram"></i> Telegram</a></li>
    
</ul>

  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../ru/it/agile/crash-course-in-software-development-economics/">May 05 - Краткий курс по экономике разработки программного обеспечения</a></li>
    
      <li><a href="../../ru/soft-skills/psychological-effects/">May 04 - Список психологических эффектов</a></li>
    
      <li><a href="../../ru/cqrs-command-and-result/">Apr 02 - Может ли CQRS-команда возвращать результат?</a></li>
    
      <li><a href="../../ru/message-ordering-in-competing-consumers/">Mar 31 - О гонке сообщений в условиях конкурирующих подписчиков</a></li>
    
      <li><a href="../../ru/domain-events-in-ddd/">May 05 - Domain Events in DDD</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/agile/">Agile</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/angular/">Angular</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/autocomplete/">Autocomplete</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/cqrs/">CQRS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cqs/">CQS</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/cache/">Cache</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/career/">Career</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-architecture/">Clean Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/clean-code/">Clean Code</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/communication/">Communication</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/db/">DB</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/ddd/">DDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/datamapper/">DataMapper</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/dependency-injection/">Dependency Injection</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/distributed-systems/">Distributed Systems</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/django/">Django</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/django-model/">Django Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/docker/">Docker</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/eip/">EIP</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/economics/">Economics</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/emacs/">Emacs</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/event-sourcing/">Event Sourcing</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/event-driven/">Event-Driven</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/extreme-programming/">Extreme Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/flux/">Flux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/fowler/">Fowler</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/functional-programming/">Functional Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hr/">HR</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hiring/">Hiring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/javascript/">JavaScript</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/management/">Management</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/microservices/">Microservices</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/model/">Model</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/oop/">OOP</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/orm/">ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/programming/">Programming</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/python/">Python</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/redux/">Redux</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/refactoring/">Refactoring</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/repository/">Repository</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/sql/">SQL</a></li>
      
    
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/scrum/">Scrum</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/service-layer/">Service Layer</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/soft-skills/">Soft Skills</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-4">
        <a href="../../blog/tag/software-architecture/">Software Architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/software-construction/">Software Construction</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/software-design/">Software Design</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/storm-orm/">Storm ORM</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/tdd/">TDD</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/xp/">XP</a></li>
      
    
      
    
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2021/">2021 (4)</a></li>
    
  
    
    <li><a href="../../blog/2020/">2020 (1)</a></li>
    
  
    
    <li><a href="../../blog/2019/">2019 (2)</a></li>
    
  
    
    <li><a href="../../blog/2018/">2018 (4)</a></li>
    
  
    
    <li><a href="../../blog/2017/">2017 (9)</a></li>
    
  
    
    <li><a href="../../blog/2016/">2016 (5)</a></li>
    
  
    
    <li><a href="../../blog/2015/">2015 (6)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2022, Ivan Zakrevsky.
      
      |
      Powered by <a href="http://ablog.readthedocs.org/">ABlog</a> &amp; <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../../_sources/en/service-layer.txt"
          rel="nofollow">Page source</a>
    </div>

    

    


    

        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-597ba7fb5af2ef1e"></script>

    


<!-- google.com/analytics counter -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69288289-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- /google.com/analytics counter -->


<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32948409 = new Ya.Metrika({
                    id:32948409,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32948409" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



  </body>
</html>